//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

// Package annotator provides an interface for creating annotations with appearance
// streams.  It goes beyond the models package which includes definitions of basic annotation models, in that it
// can create the appearance streams which specify the exact appearance as needed by many pdf viewers for consistent
// appearance of the annotations.
// It also contains methods for generating appearance streams for fields via widget annotations.
package annotator ;import (_a "bytes";_gd "errors";_gc "github.com/unidoc/unipdf/v3/common";_c "github.com/unidoc/unipdf/v3/contentstream";_ee "github.com/unidoc/unipdf/v3/contentstream/draw";_fg "github.com/unidoc/unipdf/v3/core";_e "github.com/unidoc/unipdf/v3/internal/textencoding";_cc "github.com/unidoc/unipdf/v3/model";_d "image";_cd "math";_f "strings";_gca "unicode";);func (_bbb *AppearanceStyle )applyAppearanceCharacteristics (_egd *_fg .PdfObjectDictionary ,_ecgbb *_fg .PdfObjectDictionary ,_ecc *_cc .PdfFont )error {if !_bbb .AllowMK {return nil ;};if CA ,_caa :=_fg .GetString (_egd .Get ("\u0043\u0041"));_caa &&_ecc !=nil {_agdc :=CA .Bytes ();if len (_agdc )!=0{_fef :=[]rune (_ecc .Encoder ().Decode (_agdc ));if len (_fef )==1{_bbb .CheckmarkRune =_fef [0];};};};if BC ,_fae :=_fg .GetArray (_egd .Get ("\u0042\u0043"));_fae {_egfd ,_gde :=BC .ToFloat64Array ();if _gde !=nil {return _gde ;};switch len (_egfd ){case 1:_bbb .BorderColor =_cc .NewPdfColorDeviceGray (_egfd [0]);case 3:_bbb .BorderColor =_cc .NewPdfColorDeviceRGB (_egfd [0],_egfd [1],_egfd [2]);case 4:_bbb .BorderColor =_cc .NewPdfColorDeviceCMYK (_egfd [0],_egfd [1],_egfd [2],_egfd [3]);default:_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052:\u0020\u0042\u0043\u0020\u002d\u0020\u0049\u006e\u0076\u0061\u006c\u0069\u0064 \u006e\u0075\u006d\u0062\u0065\u0072\u0020\u006f\u0066\u0020\u0063\u006f\u006c\u006f\u0072\u0020\u0063\u006f\u006d\u0070\u006f\u006e\u0065\u006e\u0074\u0073\u0020\u0028\u0025\u0064)",len (_egfd ));};if _ecgbb !=nil {if _bbe ,_cgc :=_fg .GetNumberAsFloat (_ecgbb .Get ("\u0057"));_cgc ==nil {_bbb .BorderSize =_bbe ;};};};if BG ,_aeed :=_fg .GetArray (_egd .Get ("\u0042\u0047"));_aeed {_agc ,_cbef :=BG .ToFloat64Array ();if _cbef !=nil {return _cbef ;};switch len (_agc ){case 1:_bbb .FillColor =_cc .NewPdfColorDeviceGray (_agc [0]);case 3:_bbb .FillColor =_cc .NewPdfColorDeviceRGB (_agc [0],_agc [1],_agc [2]);case 4:_bbb .FillColor =_cc .NewPdfColorDeviceCMYK (_agc [0],_agc [1],_agc [2],_agc [3]);default:_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052:\u0020\u0042\u0047\u0020\u002d\u0020\u0049\u006e\u0076\u0061\u006c\u0069\u0064 \u006e\u0075\u006d\u0062\u0065\u0072\u0020\u006f\u0066\u0020\u0063\u006f\u006c\u006f\u0072\u0020\u0063\u006f\u006d\u0070\u006f\u006e\u0065\u006e\u0074\u0073\u0020\u0028\u0025\u0064)",len (_agc ));};};return nil ;};func _cadc (_gee *_c .ContentCreator ,_aga AppearanceStyle ,_aef ,_cgff float64 ){_gee .Add_q ().Add_re (0,0,_aef ,_cgff ).Add_w (_aga .BorderSize ).SetStrokingColor (_aga .BorderColor ).SetNonStrokingColor (_aga .FillColor ).Add_B ().Add_Q ();};

// SignatureFieldOpts represents a set of options used to configure
// an appearance widget dictionary.
type SignatureFieldOpts struct{

// Rect represents the area the signature annotation is displayed on.
Rect []float64 ;

// AutoSize specifies if the content of the appearance should be
// scaled to fit in the annotation rectangle.
AutoSize bool ;

// Font specifies the font of the text content.
Font *_cc .PdfFont ;

// FontSize specifies the size of the text content.
FontSize float64 ;

// LineHeight specifies the height of a line of text in the appearance annotation.
LineHeight float64 ;

// TextColor represents the color of the text content displayed.
TextColor _cc .PdfColor ;

// FillColor represents the background color of the appearance annotation area.
FillColor _cc .PdfColor ;

// BorderSize represents border size of the appearance annotation area.
BorderSize float64 ;

// BorderColor represents the border color of the appearance annotation area.
BorderColor _cc .PdfColor ;

// WatermarkImage specifies the image used as a watermark that will be rendered
// behind the signature.
WatermarkImage _d .Image ;

// Image represents the image used for the signature appearance.
Image _d .Image ;

// Encoder specifies the image encoder used for image signature. Defaults to flate encoder.
Encoder _fg .StreamEncoder ;

// ImagePosition specifies the image location relative to the text signature.
ImagePosition SignatureImagePosition ;};

// NewCheckboxField generates a new checkbox field with partial name `name` at location `rect`
// on specified `page` and with field specific options `opt`.
func NewCheckboxField (page *_cc .PdfPage ,name string ,rect []float64 ,opt CheckboxFieldOptions )(*_cc .PdfFieldButton ,error ){if page ==nil {return nil ,_gd .New ("\u0070a\u0067e\u0020\u006e\u006f\u0074\u0020s\u0070\u0065c\u0069\u0066\u0069\u0065\u0064");};if len (name )<=0{return nil ,_gd .New ("\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u0020\u0061\u0074\u0074\u0072\u0069\u0062u\u0074e\u0020\u006e\u006f\u0074\u0020\u0073\u0070\u0065\u0063\u0069\u0066\u0069\u0065\u0064");};if len (rect )!=4{return nil ,_gd .New ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u0072\u0061\u006e\u0067\u0065");};_bge ,_fccf :=_cc .NewStandard14Font (_cc .ZapfDingbatsName );if _fccf !=nil {return nil ,_fccf ;};_gaaa :=_cc .NewPdfField ();_defa :=&_cc .PdfFieldButton {};_gaaa .SetContext (_defa );_defa .PdfField =_gaaa ;_defa .T =_fg .MakeString (name );_defa .SetType (_cc .ButtonTypeCheckbox );_ccdc :="\u004f\u0066\u0066";if opt .Checked {_ccdc ="\u0059\u0065\u0073";};_defa .V =_fg .MakeName (_ccdc );_dgc :=_cc .NewPdfAnnotationWidget ();_dgc .Rect =_fg .MakeArrayFromFloats (rect );_dgc .P =page .ToPdfObject ();_dgc .F =_fg .MakeInteger (4);_dgc .Parent =_defa .ToPdfObject ();_eggg :=rect [2]-rect [0];_deee :=rect [3]-rect [1];var _bdae _a .Buffer ;_bdae .WriteString ("\u0071\u000a");_bdae .WriteString ("\u0030 \u0030\u0020\u0031\u0020\u0072\u0067\n");_bdae .WriteString ("\u0042\u0054\u000a");_bdae .WriteString ("\u002f\u005a\u0061D\u0062\u0020\u0031\u0032\u0020\u0054\u0066\u000a");_bdae .WriteString ("\u0045\u0054\u000a");_bdae .WriteString ("\u0051\u000a");_fdaef :=_c .NewContentCreator ();_fdaef .Add_q ();_fdaef .Add_rg (0,0,1);_fdaef .Add_BT ();_fdaef .Add_Tf (*_fg .MakeName ("\u005a\u0061\u0044\u0062"),12);_fdaef .Add_Td (0,0);_fdaef .Add_ET ();_fdaef .Add_Q ();_gae :=_cc .NewXObjectForm ();_gae .SetContentStream (_fdaef .Bytes (),_fg .NewRawEncoder ());_gae .BBox =_fg .MakeArrayFromFloats ([]float64 {0,0,_eggg ,_deee });_gae .Resources =_cc .NewPdfPageResources ();_gae .Resources .SetFontByName ("\u005a\u0061\u0044\u0062",_bge .ToPdfObject ());_fdaef =_c .NewContentCreator ();_fdaef .Add_q ();_fdaef .Add_re (0,0,_eggg ,_deee );_fdaef .Add_W ().Add_n ();_fdaef .Add_rg (0,0,1);_fdaef .Translate (0,3.0);_fdaef .Add_BT ();_fdaef .Add_Tf (*_fg .MakeName ("\u005a\u0061\u0044\u0062"),12);_fdaef .Add_Td (0,0);_fdaef .Add_Tj (*_fg .MakeString ("\u0034"));_fdaef .Add_ET ();_fdaef .Add_Q ();_cgfd :=_cc .NewXObjectForm ();_cgfd .SetContentStream (_fdaef .Bytes (),_fg .NewRawEncoder ());_cgfd .BBox =_fg .MakeArrayFromFloats ([]float64 {0,0,_eggg ,_deee });_cgfd .Resources =_cc .NewPdfPageResources ();_cgfd .Resources .SetFontByName ("\u005a\u0061\u0044\u0062",_bge .ToPdfObject ());_caee :=_fg .MakeDict ();_caee .Set ("\u004f\u0066\u0066",_gae .ToPdfObject ());_caee .Set ("\u0059\u0065\u0073",_cgfd .ToPdfObject ());_eba :=_fg .MakeDict ();_eba .Set ("\u004e",_caee );_dgc .AP =_eba ;_dgc .AS =_fg .MakeName (_ccdc );_defa .Annotations =append (_defa .Annotations ,_dgc );return _defa ,nil ;};

// AppearanceFont represents a font used for generating the appearance of a
// field in the filling/flattening process.
type AppearanceFont struct{

// Name represents the name of the font which will be added to the
// AcroForm resources (DR).
Name string ;

// Font represents the actual font used for the field appearance.
Font *_cc .PdfFont ;

// Size represents the size of the font used for the field appearance.
// If size is 0, a default font size will be used.
// The default font size is calculated using the available annotation
// height and the AutoFontSizeFraction of the AppearanceStyle.
Size float64 ;};type quadding int ;

// NewSignatureLine returns a new signature line displayed as a part of the
// signature field appearance.
func NewSignatureLine (desc ,text string )*SignatureLine {return &SignatureLine {Desc :desc ,Text :text };};func _cadbc (_bfc RectangleAnnotationDef )(*_fg .PdfObjectDictionary ,*_cc .PdfRectangle ,error ){_acc :=_cc .NewXObjectForm ();_acc .Resources =_cc .NewPdfPageResources ();_ebfe :="";if _bfc .Opacity < 1.0{_fafd :=_fg .MakeDict ();_fafd .Set ("\u0063\u0061",_fg .MakeFloat (_bfc .Opacity ));_fafd .Set ("\u0043\u0041",_fg .MakeFloat (_bfc .Opacity ));_ccdg :=_acc .Resources .AddExtGState ("\u0067\u0073\u0031",_fafd );if _ccdg !=nil {_gc .Log .Debug ("U\u006e\u0061\u0062\u006c\u0065\u0020t\u006f\u0020\u0061\u0064\u0064\u0020\u0065\u0078\u0074g\u0073\u0074\u0061t\u0065 \u0067\u0073\u0031");return nil ,nil ,_ccdg ;};_ebfe ="\u0067\u0073\u0031";};_fgecd ,_bbea ,_ccbbf ,_ccgbe :=_fcge (_bfc ,_ebfe );if _ccgbe !=nil {return nil ,nil ,_ccgbe ;};_ccgbe =_acc .SetContentStream (_fgecd ,nil );if _ccgbe !=nil {return nil ,nil ,_ccgbe ;};_acc .BBox =_bbea .ToPdfObject ();_gdgf :=_fg .MakeDict ();_gdgf .Set ("\u004e",_acc .ToPdfObject ());return _gdgf ,_ccbbf ,nil ;};

// Style returns the appearance style of `fa`. If not specified, returns default style.
func (_ff FieldAppearance )Style ()AppearanceStyle {if _ff ._dg !=nil {return *_ff ._dg ;};return AppearanceStyle {AutoFontSizeFraction :0.65,CheckmarkRune :'âœ”',BorderSize :0.0,BorderColor :_cc .NewPdfColorDeviceGray (0),FillColor :_cc .NewPdfColorDeviceGray (1),MultilineLineHeight :1.2,MultilineVAlignMiddle :false ,DrawAlignmentReticle :false ,AllowMK :true };};func _aea (_bab *_c .ContentCreator ,_fdae AppearanceStyle ,_eaea ,_ccag float64 ){_bab .Add_q ().Add_re (0,0,_eaea ,_ccag ).Add_re (0,_ccag /2,_eaea ,_ccag /2).Add_re (0,0,_eaea ,_ccag ).Add_re (_eaea /2,0,_eaea /2,_ccag ).Add_w (_fdae .BorderSize ).SetStrokingColor (_fdae .BorderColor ).SetNonStrokingColor (_fdae .FillColor ).Add_B ().Add_Q ();};func _dd (_ag *_cc .PdfAnnotationWidget ,_aaf *_cc .PdfFieldText ,_cg *_cc .PdfPageResources ,_ccg AppearanceStyle )(*_fg .PdfObjectDictionary ,error ){_eaa :=_cc .NewPdfPageResources ();_de ,_eec :=_fg .GetArray (_ag .Rect );if !_eec {return nil ,_gd .New ("\u0069\u006e\u0076a\u006c\u0069\u0064\u0020\u0052\u0065\u0063\u0074");};_bg ,_gcfa :=_cc .NewPdfRectangle (*_de );if _gcfa !=nil {return nil ,_gcfa ;};_af ,_eaaf :=_bg .Width (),_bg .Height ();_cbe ,_fad :=_af ,_eaaf ;_aac ,_cgb :=_fg .GetDict (_ag .MK );if _cgb {_fcc ,_ :=_fg .GetDict (_ag .BS );_bag :=_ccg .applyAppearanceCharacteristics (_aac ,_fcc ,nil );if _bag !=nil {return nil ,_bag ;};};_fb ,_gcfa :=_c .NewContentStreamParser (_facd (_aaf .PdfField )).Parse ();if _gcfa !=nil {return nil ,_gcfa ;};_gfe :=_c .NewContentCreator ();if _ccg .BorderSize > 0{_cadc (_gfe ,_ccg ,_af ,_eaaf );};if _ccg .DrawAlignmentReticle {_ed :=_ccg ;_ed .BorderSize =0.2;_aea (_gfe ,_ed ,_af ,_eaaf );};_gfe .Add_BMC ("\u0054\u0078");_gfe .Add_q ();_af ,_eaaf =_ccg .applyRotation (_aac ,_af ,_eaaf ,_gfe );_gfe .Add_BT ();_ca ,_gbd ,_gcfa :=_ccg .processDA (_aaf .PdfField ,_fb ,_cg ,_eaa ,_gfe );if _gcfa !=nil {return nil ,_gcfa ;};_aaa :=_ca .Font ;_gbc :=_ca .Size ;_df :=_fg .MakeName (_ca .Name );_dec :=_gbc ==0;if _dec &&_gbd {_gbc =_eaaf *_ccg .AutoFontSizeFraction ;};_gcb :=_aaa .Encoder ();if _gcb ==nil {_gc .Log .Debug ("\u0057\u0041RN\u003a\u0020\u0066\u006f\u006e\u0074\u0020\u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0069\u0073\u0020\u006e\u0069l\u002e\u0020\u0041\u0073s\u0075\u006d\u0069\u006eg \u0069\u0064e\u006et\u0069\u0074\u0079\u0020\u0065\u006ec\u006f\u0064\u0065r\u002e\u0020O\u0075\u0074\u0070\u0075\u0074\u0020\u006d\u0061\u0079\u0020\u0062\u0065\u0020\u0069n\u0063\u006f\u0072\u0072\u0065\u0063\u0074\u002e");_gcb =_e .NewIdentityTextEncoder ("\u0049\u0064\u0065\u006e\u0074\u0069\u0074\u0079\u002d\u0048");};_ebc ,_gcfa :=_aaa .GetFontDescriptor ();if _gcfa !=nil {_gc .Log .Debug ("\u0045\u0072ro\u0072\u003a\u0020U\u006e\u0061\u0062\u006ce t\u006f g\u0065\u0074\u0020\u0066\u006f\u006e\u0074 d\u0065\u0073\u0063\u0072\u0069\u0070\u0074o\u0072");};var _fe string ;if _dece ,_ad :=_fg .GetString (_aaf .V );_ad {_fe =_dece .Decoded ();};if len (_fe )==0{return nil ,nil ;};_aee :=[]string {_fe };_ecb :=false ;if _aaf .Flags ().Has (_cc .FieldFlagMultiline ){_ecb =true ;_fe =_f .Replace (_fe ,"\u000d\u000a","\u000a",-1);_fe =_f .Replace (_fe ,"\u000d","\u000a",-1);_aee =_f .Split (_fe ,"\u000a");};_cdag :=0.0;_fafe :=0;if _gcb !=nil {_eaab :=len (_aee );_bga :=0;for _bga < _eaab {var _abd float64 ;_gea :=-1;_cgd :=0.0;for _bbg ,_eeb :=range _aee [_bga ]{if _eeb ==' '{_gea =_bbg ;_abd =_cgd ;};_ccc ,_fdf :=_aaa .GetRuneMetrics (_eeb );if !_fdf {_gc .Log .Debug ("\u0046\u006f\u006e\u0074\u0020\u0064o\u0065\u0073\u0020\u006e\u006f\u0074\u0020\u0068\u0061\u0076\u0065\u0020\u0072\u0075\u006e\u0065\u0020\u006d\u0065\u0074r\u0069\u0063\u0073\u0020\u0066\u006f\u0072\u0020\u0025\u0076\u0020\u002d\u0020\u0073k\u0069p\u0070\u0069\u006e\u0067",_eeb );continue ;};_cgd +=_ccc .Wx ;if _ecb &&!_dec &&_gbc *_cgd /1000.0> _af &&_gea > 0{_ege :=_aee [_bga ][_gea +1:];if _bga < len (_aee )-1{_aee =append (_aee [:_bga +1],_aee [_bga :]...);_aee [_bga +1]=_ege ;}else {_aee =append (_aee ,_ege );};_eaab ++;_aee [_bga ]=_aee [_bga ][0:_gea ];_cgd =_abd ;break ;};};if _cgd > _cdag {_cdag =_cgd ;};_aee [_bga ]=string (_gcb .Encode (_aee [_bga ]));if len (_aee [_bga ])> 0{_fafe ++;};_bga ++;};};_dce :=2.0;if _gbc ==0||_dec &&_cdag > 0&&_dce +_cdag *_gbc /1000.0> _af {_gbc =0.95*1000.0*(_af -_dce )/_cdag ;};_bdc :=_cbd ;{if _cgba ,_dff :=_fg .GetIntVal (_aaf .Q );_dff {switch _cgba {case 0:_bdc =_cbd ;case 1:_bdc =_fa ;case 2:_bdc =_gaf ;default:_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052\u003a\u0020\u0055\u006e\u0073\u0075\u0070\u0070\u006f\u0072t\u0065\u0064\u0020\u0071\u0075\u0061\u0064\u0064\u0069\u006e\u0067\u003a\u0020%\u0064\u0020\u002d\u0020\u0075\u0073\u0069\u006e\u0067\u0020\u006c\u0065ft\u0020\u0061\u006c\u0069\u0067\u006e\u006d\u0065\u006e\u0074",_cgba );};};};_bgd :=_ccg .MultilineLineHeight ;_ceb :=_gbc ;if _ecb &&_fafe > 1{_ceb =_bgd *_gbc ;};var _edc float64 ;if _ebc !=nil {_edc ,_gcfa =_ebc .GetCapHeight ();if _gcfa !=nil {_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052\u003a\u0020\u0055\u006e\u0061\u0062\u006c\u0065 \u0074\u006f\u0020\u0067\u0065\u0074 \u0066\u006f\u006e\u0074\u0020\u0043\u0061\u0070\u0048\u0065\u0069\u0067\u0068t\u003a\u0020\u0025\u0076",_gcfa );};};if int (_edc )<=0{_gc .Log .Debug ("W\u0041\u0052\u004e\u003a\u0020\u0043\u0061\u0070\u0048e\u0069\u0067\u0068\u0074\u0020\u006e\u006ft \u0061\u0076\u0061\u0069l\u0061\u0062\u006c\u0065\u0020\u002d\u0020\u0073\u0065tt\u0069\u006eg\u0020\u0074\u006f\u0020\u0031\u0030\u0030\u0030");_edc =1000;};_eed :=_edc /1000.0*_gbc ;_bbf :=0.0;{_cfc :=float64 (_fafe )*_ceb ;if _dec &&_bbf +_cfc > _eaaf {_gbc =0.95*(_eaaf -_bbf )/float64 (_fafe );_ceb =_gbc ;if _ecb &&_fafe > 1{_ceb =_bgd *_gbc ;};_eed =_edc /1000.0*_gbc ;_cfc =float64 (_fafe )*_ceb ;};if _eaaf > _cfc {if _ecb {if _ccg .MultilineVAlignMiddle {_gfg :=(_eaaf -_cfc )/2.0;_eae :=_gfg +_cfc -_ceb ;_bbf =_eae ;}else {_bbf =_eaaf -_ceb ;_bbf -=_gbc *0.5;};}else {_bbf =(_eaaf -_eed )/2.0;};};};_gfe .Add_Tf (*_df ,_gbc );_gfe .Add_Td (_dce ,_bbf );_cee :=_dce ;_gag :=_dce ;for _gdg ,_ceba :=range _aee {_gcae :=0.0;for _ ,_fadb :=range _ceba {_facg ,_bbgd :=_aaa .GetRuneMetrics (_fadb );if !_bbgd {continue ;};_gcae +=_facg .Wx ;};_fde :=_gcae /1000.0*_gbc ;_eef :=_af -_fde ;var _aed float64 ;switch _bdc {case _cbd :_aed =_cee ;case _fa :_aed =_eef /2;case _gaf :_aed =_eef ;};_dce =_aed -_gag ;if _dce > 0.0{_gfe .Add_Td (_dce ,0);};_gag =_aed ;_gfe .Add_Tj (*_fg .MakeString (_ceba ));if _gdg < len (_aee )-1{_gfe .Add_Td (0,-_ceb *_bgd );};};_gfe .Add_ET ();_gfe .Add_Q ();_gfe .Add_EMC ();_baa :=_cc .NewXObjectForm ();_baa .Resources =_eaa ;_baa .BBox =_fg .MakeArrayFromFloats ([]float64 {0,0,_cbe ,_fad });_baa .SetContentStream (_gfe .Bytes (),_gbe ());_abaf :=_fg .MakeDict ();_abaf .Set ("\u004e",_baa .ToPdfObject ());return _abaf ,nil ;};

// RectangleAnnotationDef is a rectangle defined with a specified Width and Height and a lower left corner at (X,Y).
// The rectangle can optionally have a border and a filling color.
// The Width/Height includes the border (if any specified).
type RectangleAnnotationDef struct{X float64 ;Y float64 ;Width float64 ;Height float64 ;FillEnabled bool ;FillColor *_cc .PdfColorDeviceRGB ;BorderEnabled bool ;BorderWidth float64 ;BorderColor *_cc .PdfColorDeviceRGB ;Opacity float64 ;};func _bf (_ea CircleAnnotationDef )(*_fg .PdfObjectDictionary ,*_cc .PdfRectangle ,error ){_ac :=_cc .NewXObjectForm ();_ac .Resources =_cc .NewPdfPageResources ();_ab :="";if _ea .Opacity < 1.0{_gcf :=_fg .MakeDict ();_gcf .Set ("\u0063\u0061",_fg .MakeFloat (_ea .Opacity ));_gcf .Set ("\u0043\u0041",_fg .MakeFloat (_ea .Opacity ));_dcg :=_ac .Resources .AddExtGState ("\u0067\u0073\u0031",_gcf );if _dcg !=nil {_gc .Log .Debug ("U\u006e\u0061\u0062\u006c\u0065\u0020t\u006f\u0020\u0061\u0064\u0064\u0020\u0065\u0078\u0074g\u0073\u0074\u0061t\u0065 \u0067\u0073\u0031");return nil ,nil ,_dcg ;};_ab ="\u0067\u0073\u0031";};_eg ,_cda ,_cb ,_bfg :=_bc (_ea ,_ab );if _bfg !=nil {return nil ,nil ,_bfg ;};_bfg =_ac .SetContentStream (_eg ,nil );if _bfg !=nil {return nil ,nil ,_bfg ;};_ac .BBox =_cda .ToPdfObject ();_cf :=_fg .MakeDict ();_cf .Set ("\u004e",_ac .ToPdfObject ());return _cf ,_cb ,nil ;};func _dga (_aabd _d .Image ,_bbff string ,_gebc *SignatureFieldOpts ,_ecfc []float64 ,_gaab *_c .ContentCreator )(*_fg .PdfObjectName ,*_cc .XObjectImage ,error ){_fgbc ,_gba :=_cc .DefaultImageHandler {}.NewImageFromGoImage (_aabd );if _gba !=nil {return nil ,nil ,_gba ;};_deea ,_gba :=_cc .NewXObjectImageFromImage (_fgbc ,nil ,_gebc .Encoder );if _gba !=nil {return nil ,nil ,_gba ;};_dbcg ,_edgg :=float64 (*_deea .Width ),float64 (*_deea .Height );_eebf :=_ecfc [2]-_ecfc [0];_gfd :=_ecfc [3]-_ecfc [1];if _gebc .AutoSize {_gaac :=_cd .Min (_eebf /_dbcg ,_gfd /_edgg );_dbcg *=_gaac ;_edgg *=_gaac ;_ecfc [0]=_ecfc [0]+(_eebf /2)-(_dbcg /2);_ecfc [1]=_ecfc [1]+(_gfd /2)-(_edgg /2);};var _bdag *_fg .PdfObjectName ;if _ebf ,_dcfcf :=_fg .GetName (_deea .Name );_dcfcf {_bdag =_ebf ;}else {_bdag =_fg .MakeName (_bbff );};if _gaab !=nil {_gaab .Add_q ().Translate (_ecfc [0],_ecfc [1]).Scale (_dbcg ,_edgg ).Add_Do (*_bdag ).Add_Q ();}else {return nil ,nil ,_gd .New ("\u0043\u006f\u006e\u0074en\u0074\u0043\u0072\u0065\u0061\u0074\u006f\u0072\u0020\u0069\u0073\u0020\u006e\u0075l\u006c");};return _bdag ,_deea ,nil ;};

// LineAnnotationDef defines a line between point 1 (X1,Y1) and point 2 (X2,Y2).  The line ending styles can be none
// (regular line), or arrows at either end.  The line also has a specified width, color and opacity.
type LineAnnotationDef struct{X1 float64 ;Y1 float64 ;X2 float64 ;Y2 float64 ;LineColor *_cc .PdfColorDeviceRGB ;Opacity float64 ;LineWidth float64 ;LineEndingStyle1 _ee .LineEndingStyle ;LineEndingStyle2 _ee .LineEndingStyle ;};const (SignatureImageLeft SignatureImagePosition =iota ;SignatureImageRight ;SignatureImageTop ;SignatureImageBottom ;);

// ComboboxFieldOptions defines optional parameters for a combobox form field.
type ComboboxFieldOptions struct{

// Choices is the list of string values that can be selected.
Choices []string ;};

// SignatureLine represents a line of information in the signature field appearance.
type SignatureLine struct{Desc string ;Text string ;};func _bc (_geb CircleAnnotationDef ,_fge string )([]byte ,*_cc .PdfRectangle ,*_cc .PdfRectangle ,error ){_egf :=_ee .Circle {X :_geb .X ,Y :_geb .Y ,Width :_geb .Width ,Height :_geb .Height ,FillEnabled :_geb .FillEnabled ,FillColor :_geb .FillColor ,BorderEnabled :_geb .BorderEnabled ,BorderWidth :_geb .BorderWidth ,BorderColor :_geb .BorderColor ,Opacity :_geb .Opacity };_fca ,_db ,_ecg :=_egf .Draw (_fge );if _ecg !=nil {return nil ,nil ,nil ,_ecg ;};_eb :=&_cc .PdfRectangle {};_eb .Llx =_geb .X +_db .Llx ;_eb .Lly =_geb .Y +_db .Lly ;_eb .Urx =_geb .X +_db .Urx ;_eb .Ury =_geb .Y +_db .Ury ;return _fca ,_db ,_eb ,nil ;};

// WrapContentStream ensures that the entire content stream for a `page` is wrapped within q ... Q operands.
// Ensures that following operands that are added are not affected by additional operands that are added.
// Implements interface model.ContentStreamWrapper.
func (_ecgbf FieldAppearance )WrapContentStream (page *_cc .PdfPage )error {_cfa ,_gff :=page .GetAllContentStreams ();if _gff !=nil {return _gff ;};_bbcg :=_c .NewContentStreamParser (_cfa );_ecbc ,_gff :=_bbcg .Parse ();if _gff !=nil {return _gff ;};_ecbc .WrapIfNeeded ();_gbcb :=[]string {_ecbc .String ()};return page .SetContentStreams (_gbcb ,_gbe ());};

// CreateRectangleAnnotation creates a rectangle annotation object that can be added to page PDF annotations.
func CreateRectangleAnnotation (rectDef RectangleAnnotationDef )(*_cc .PdfAnnotation ,error ){_cdad :=_cc .NewPdfAnnotationSquare ();if rectDef .BorderEnabled {_gged ,_cdg ,_eega :=rectDef .BorderColor .R (),rectDef .BorderColor .G (),rectDef .BorderColor .B ();_cdad .C =_fg .MakeArrayFromFloats ([]float64 {_gged ,_cdg ,_eega });_cgfe :=_cc .NewBorderStyle ();_cgfe .SetBorderWidth (rectDef .BorderWidth );_cdad .BS =_cgfe .ToPdfObject ();};if rectDef .FillEnabled {_dgf ,_gddg ,_fcf :=rectDef .FillColor .R (),rectDef .FillColor .G (),rectDef .FillColor .B ();_cdad .IC =_fg .MakeArrayFromFloats ([]float64 {_dgf ,_gddg ,_fcf });}else {_cdad .IC =_fg .MakeArrayFromIntegers ([]int {});};if rectDef .Opacity < 1.0{_cdad .CA =_fg .MakeFloat (rectDef .Opacity );};_dgag ,_bbba ,_gfgf :=_cadbc (rectDef );if _gfgf !=nil {return nil ,_gfgf ;};_cdad .AP =_dgag ;_cdad .Rect =_fg .MakeArrayFromFloats ([]float64 {_bbba .Llx ,_bbba .Lly ,_bbba .Urx ,_bbba .Ury });return _cdad .PdfAnnotation ,nil ;};func (_dage *AppearanceStyle )applyRotation (_dba *_fg .PdfObjectDictionary ,_fab ,_dea float64 ,_bbcf *_c .ContentCreator )(float64 ,float64 ){if !_dage .AllowMK {return _fab ,_dea ;};if _dba ==nil {return _fab ,_dea ;};_fdfg ,_ :=_fg .GetNumberAsFloat (_dba .Get ("\u0052"));if _fdfg ==0{return _fab ,_dea ;};_ggg :=-_fdfg ;_ccd :=_ee .Path {Points :[]_ee .Point {_ee .NewPoint (0,0).Rotate (_ggg ),_ee .NewPoint (_fab ,0).Rotate (_ggg ),_ee .NewPoint (0,_dea ).Rotate (_ggg ),_ee .NewPoint (_fab ,_dea ).Rotate (_ggg )}}.GetBoundingBox ();_bbcf .RotateDeg (_fdfg );_bbcf .Translate (_ccd .X ,_ccd .Y );return _ccd .Width ,_ccd .Height ;};const (_cbd quadding =0;_fa quadding =1;_gaf quadding =2;);

// TextFieldOptions defines optional parameter for a text field in a form.
type TextFieldOptions struct{MaxLen int ;Value string ;};func _facd (_dagb *_cc .PdfField )string {if _dagb ==nil {return "";};_fbbc ,_ecgf :=_dagb .GetContext ().(*_cc .PdfFieldText );if !_ecgf {return _facd (_dagb .Parent );};if _fbbc .DA !=nil {return _fbbc .DA .Str ();};return _facd (_fbbc .Parent );};

// CreateCircleAnnotation creates a circle/ellipse annotation object with appearance stream that can be added to
// page PDF annotations.
func CreateCircleAnnotation (circDef CircleAnnotationDef )(*_cc .PdfAnnotation ,error ){_ga :=_cc .NewPdfAnnotationCircle ();if circDef .BorderEnabled {_fgb ,_b ,_ae :=circDef .BorderColor .R (),circDef .BorderColor .G (),circDef .BorderColor .B ();_ga .C =_fg .MakeArrayFromFloats ([]float64 {_fgb ,_b ,_ae });_ec :=_cc .NewBorderStyle ();_ec .SetBorderWidth (circDef .BorderWidth );_ga .BS =_ec .ToPdfObject ();};if circDef .FillEnabled {_ba ,_dc ,_ge :=circDef .FillColor .R (),circDef .FillColor .G (),circDef .FillColor .B ();_ga .IC =_fg .MakeArrayFromFloats ([]float64 {_ba ,_dc ,_ge });}else {_ga .IC =_fg .MakeArrayFromIntegers ([]int {});};if circDef .Opacity < 1.0{_ga .CA =_fg .MakeFloat (circDef .Opacity );};_fc ,_gb ,_ce :=_bf (circDef );if _ce !=nil {return nil ,_ce ;};_ga .AP =_fc ;_ga .Rect =_fg .MakeArrayFromFloats ([]float64 {_gb .Llx ,_gb .Lly ,_gb .Urx ,_gb .Ury });return _ga .PdfAnnotation ,nil ;};func _fdb (_ddb *_cc .PdfAcroForm ,_ceed *_cc .PdfAnnotationWidget ,_fda *_cc .PdfFieldChoice ,_bcda AppearanceStyle )(*_fg .PdfObjectDictionary ,error ){_bed ,_fbb :=_fg .GetArray (_ceed .Rect );if !_fbb {return nil ,_gd .New ("\u0069\u006e\u0076a\u006c\u0069\u0064\u0020\u0052\u0065\u0063\u0074");};_cae ,_gfa :=_cc .NewPdfRectangle (*_bed );if _gfa !=nil {return nil ,_gfa ;};_fgec ,_gcc :=_cae .Width (),_cae .Height ();_gc .Log .Debug ("\u0043\u0068\u006f\u0069\u0063\u0065\u002c\u0020\u0077\u0061\u0020\u0042S\u003a\u0020\u0025\u0076",_ceed .BS );_bagd ,_gfa :=_c .NewContentStreamParser (_facd (_fda .PdfField )).Parse ();if _gfa !=nil {return nil ,_gfa ;};_caeg ,_cga :=_fg .GetDict (_ceed .MK );if _cga {_gce ,_ :=_fg .GetDict (_ceed .BS );_dcee :=_bcda .applyAppearanceCharacteristics (_caeg ,_gce ,nil );if _dcee !=nil {return nil ,_dcee ;};};_dde :=_fg .MakeDict ();for _ ,_egeb :=range _fda .Opt .Elements (){if _ceeg ,_gdb :=_fg .GetArray (_egeb );_gdb &&_ceeg .Len ()==2{_egeb =_ceeg .Get (1);};var _ffdg string ;if _dfdb ,_cgbae :=_fg .GetString (_egeb );_cgbae {_ffdg =_dfdb .Decoded ();}else if _bega ,_fcd :=_fg .GetName (_egeb );_fcd {_ffdg =_bega .String ();}else {_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052\u003a \u004f\u0070\u0074\u0020\u006e\u006f\u0074\u0020\u0061\u0020\u006e\u0061\u006de\u002f\u0073\u0074\u0072\u0069\u006e\u0067 \u002d\u0020\u0025\u0054",_egeb );return nil ,_gd .New ("\u006e\u006f\u0074\u0020\u0061\u0020\u006e\u0061\u006d\u0065\u002f\u0073t\u0072\u0069\u006e\u0067");};if len (_ffdg )> 0{_bggd ,_dfg :=_aeb (_fda .PdfField ,_fgec ,_gcc ,_ffdg ,_bcda ,_bagd ,_ddb .DR ,_caeg );if _dfg !=nil {return nil ,_dfg ;};_dde .Set (*_fg .MakeName (_ffdg ),_bggd .ToPdfObject ());};};_aaff :=_fg .MakeDict ();_aaff .Set ("\u004e",_dde );return _aaff ,nil ;};

// AppearanceFontStyle defines font style characteristics for form fields,
// used in the filling/flattening process.
type AppearanceFontStyle struct{

// Fallback represents a global font fallback, used for fields which do
// not specify a font in their default appearance (DA). The fallback is
// also used if there is a font specified in the DA, but it is not
// found in the AcroForm resources (DR).
Fallback *AppearanceFont ;

// FieldFallbacks defines font fallbacks for specific fields. The map keys
// represent the names of the fields (which can be specified by their
// partial or full names). Specific field fallback fonts take precedence
// over the global font fallback.
FieldFallbacks map[string ]*AppearanceFont ;

// ForceReplace forces the replacement of fonts in the filling/flattening
// process, even if the default appearance (DA) specify a valid font.
// If no fallback font is provided, setting this field has no effect.
ForceReplace bool ;};

// NewTextField generates a new text field with partial name `name` at location
// specified by `rect` on given `page` and with field specific options `opt`.
func NewTextField (page *_cc .PdfPage ,name string ,rect []float64 ,opt TextFieldOptions )(*_cc .PdfFieldText ,error ){if page ==nil {return nil ,_gd .New ("\u0070a\u0067e\u0020\u006e\u006f\u0074\u0020s\u0070\u0065c\u0069\u0066\u0069\u0065\u0064");};if len (name )<=0{return nil ,_gd .New ("\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u0020\u0061\u0074\u0074\u0072\u0069\u0062u\u0074e\u0020\u006e\u006f\u0074\u0020\u0073\u0070\u0065\u0063\u0069\u0066\u0069\u0065\u0064");};if len (rect )!=4{return nil ,_gd .New ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u0072\u0061\u006e\u0067\u0065");};_cedc :=_cc .NewPdfField ();_ceca :=&_cc .PdfFieldText {};_cedc .SetContext (_ceca );_ceca .PdfField =_cedc ;_ceca .T =_fg .MakeString (name );if opt .MaxLen > 0{_ceca .MaxLen =_fg .MakeInteger (int64 (opt .MaxLen ));};if len (opt .Value )> 0{_ceca .V =_fg .MakeString (opt .Value );};_eaeae :=_cc .NewPdfAnnotationWidget ();_eaeae .Rect =_fg .MakeArrayFromFloats (rect );_eaeae .P =page .ToPdfObject ();_eaeae .F =_fg .MakeInteger (4);_eaeae .Parent =_ceca .ToPdfObject ();_ceca .Annotations =append (_ceca .Annotations ,_eaeae );return _ceca ,nil ;};

// CheckboxFieldOptions defines optional parameters for a checkbox field a form.
type CheckboxFieldOptions struct{Checked bool ;};func _fcge (_gbg RectangleAnnotationDef ,_cbbg string )([]byte ,*_cc .PdfRectangle ,*_cc .PdfRectangle ,error ){_edcf :=_ee .Rectangle {X :0,Y :0,Width :_gbg .Width ,Height :_gbg .Height ,FillEnabled :_gbg .FillEnabled ,FillColor :_gbg .FillColor ,BorderEnabled :_gbg .BorderEnabled ,BorderWidth :2*_gbg .BorderWidth ,BorderColor :_gbg .BorderColor ,Opacity :_gbg .Opacity };_begd ,_deab ,_cgfbe :=_edcf .Draw (_cbbg );if _cgfbe !=nil {return nil ,nil ,nil ,_cgfbe ;};_gccg :=&_cc .PdfRectangle {};_gccg .Llx =_gbg .X +_deab .Llx ;_gccg .Lly =_gbg .Y +_deab .Lly ;_gccg .Urx =_gbg .X +_deab .Urx ;_gccg .Ury =_gbg .Y +_deab .Ury ;return _begd ,_deab ,_gccg ,nil ;};

// AppearanceStyle defines style parameters for appearance stream generation.
type AppearanceStyle struct{

// How much of Rect height to fill when autosizing text.
AutoFontSizeFraction float64 ;

// CheckmarkRune is a rune used for check mark in checkboxes (for ZapfDingbats font).
CheckmarkRune rune ;BorderSize float64 ;BorderColor _cc .PdfColor ;FillColor _cc .PdfColor ;

// Multiplier for lineheight for multi line text.
MultilineLineHeight float64 ;MultilineVAlignMiddle bool ;

// Visual guide checking alignment of field contents (debugging).
DrawAlignmentReticle bool ;

// Allow field MK appearance characteristics to override style settings.
AllowMK bool ;

// Fonts holds appearance styles for fonts.
Fonts *AppearanceFontStyle ;};

// SetStyle applies appearance `style` to `fa`.
func (_ef *FieldAppearance )SetStyle (style AppearanceStyle ){_ef ._dg =&style };

// SignatureImagePosition specifies the image signature location relative to the text signature.
// If text signature is not defined, this position will be ignored.
type SignatureImagePosition int ;

// NewComboboxField generates a new combobox form field with partial name `name` at location `rect`
// on specified `page` and with field specific options `opt`.
func NewComboboxField (page *_cc .PdfPage ,name string ,rect []float64 ,opt ComboboxFieldOptions )(*_cc .PdfFieldChoice ,error ){if page ==nil {return nil ,_gd .New ("\u0070a\u0067e\u0020\u006e\u006f\u0074\u0020s\u0070\u0065c\u0069\u0066\u0069\u0065\u0064");};if len (name )<=0{return nil ,_gd .New ("\u0072\u0065\u0071\u0075\u0069\u0072\u0065\u0064\u0020\u0061\u0074\u0074\u0072\u0069\u0062u\u0074e\u0020\u006e\u006f\u0074\u0020\u0073\u0070\u0065\u0063\u0069\u0066\u0069\u0065\u0064");};if len (rect )!=4{return nil ,_gd .New ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u0072\u0061\u006e\u0067\u0065");};_aeee :=_cc .NewPdfField ();_fdc :=&_cc .PdfFieldChoice {};_aeee .SetContext (_fdc );_fdc .PdfField =_aeee ;_fdc .T =_fg .MakeString (name );_fdc .Opt =_fg .MakeArray ();for _ ,_gfc :=range opt .Choices {_fdc .Opt .Append (_fg .MakeString (_gfc ));};_fdc .SetFlag (_cc .FieldFlagCombo );_deaf :=_cc .NewPdfAnnotationWidget ();_deaf .Rect =_fg .MakeArrayFromFloats (rect );_deaf .P =page .ToPdfObject ();_deaf .F =_fg .MakeInteger (4);_deaf .Parent =_fdc .ToPdfObject ();_fdc .Annotations =append (_fdc .Annotations ,_deaf );return _fdc ,nil ;};func _ecbd (_gcfd []*SignatureLine ,_fcg *SignatureFieldOpts )(*_fg .PdfObjectDictionary ,error ){if _fcg ==nil {_fcg =NewSignatureFieldOpts ();};var _ddf error ;var _gedb *_fg .PdfObjectName ;_eefa :=_fcg .Font ;if _eefa !=nil {_fga ,_ :=_eefa .GetFontDescriptor ();if _fga !=nil {if _abf ,_afee :=_fga .FontName .(*_fg .PdfObjectName );_afee {_gedb =_abf ;};};if _gedb ==nil {_gedb =_fg .MakeName ("\u0046\u006f\u006et\u0031");};}else {if _eefa ,_ddf =_cc .NewStandard14Font ("\u0048e\u006c\u0076\u0065\u0074\u0069\u0063a");_ddf !=nil {return nil ,_ddf ;};_gedb =_fg .MakeName ("\u0048\u0065\u006c\u0076");};_gab :=_fcg .FontSize ;if _gab <=0{_gab =10;};if _fcg .LineHeight <=0{_fcg .LineHeight =1;};_eeeb :=_fcg .LineHeight *_gab ;_cccb ,_eecf :=_eefa .GetRuneMetrics (' ');if !_eecf {return nil ,_gd .New ("\u0074\u0068e \u0066\u006f\u006et\u0020\u0064\u006f\u0065s n\u006ft \u0068\u0061\u0076\u0065\u0020\u0061\u0020sp\u0061\u0063\u0065\u0020\u0067\u006c\u0079p\u0068");};_bfee :=_cccb .Wx ;var _gffb float64 ;var _dbca []string ;for _ ,_dcfc :=range _gcfd {if _dcfc .Text ==""{continue ;};_cadf :=_dcfc .Text ;if _dcfc .Desc !=""{_cadf =_dcfc .Desc +"\u003a\u0020"+_cadf ;};_dbca =append (_dbca ,_cadf );var _effb float64 ;for _ ,_baab :=range _cadf {_fdd ,_cbf :=_eefa .GetRuneMetrics (_baab );if !_cbf {continue ;};_effb +=_fdd .Wx ;};if _effb > _gffb {_gffb =_effb ;};};_gffb =_gffb *_gab /1000.0;_efd :=float64 (len (_dbca ))*_eeeb ;_agcd :=_fcg .Image !=nil ;_cgfb :=_fcg .Rect ;if _cgfb ==nil {_cgfb =[]float64 {0,0,_gffb ,_efd };if _agcd {_cgfb [2]=_gffb *2;_cgfb [3]=_efd *2;};_fcg .Rect =_cgfb ;};_bfb :=_cgfb [2]-_cgfb [0];_gbf :=_cgfb [3]-_cgfb [1];_bdb ,_ecf :=_cgfb ,_cgfb ;var _cec ,_fceg float64 ;if _agcd &&len (_dbca )> 0{if _fcg .ImagePosition <=SignatureImageRight {_cfgg :=[]float64 {_cgfb [0],_cgfb [1],_cgfb [0]+(_bfb /2),_cgfb [3]};_aaaf :=[]float64 {_cgfb [0]+(_bfb /2),_cgfb [1],_cgfb [2],_cgfb [3]};if _fcg .ImagePosition ==SignatureImageLeft {_bdb ,_ecf =_cfgg ,_aaaf ;}else {_bdb ,_ecf =_aaaf ,_cfgg ;};}else {_dgd :=[]float64 {_cgfb [0],_cgfb [1],_cgfb [2],_cgfb [1]+(_gbf /2)};_fbg :=[]float64 {_cgfb [0],_cgfb [1]+(_gbf /2),_cgfb [2],_cgfb [3]};if _fcg .ImagePosition ==SignatureImageTop {_bdb ,_ecf =_fbg ,_dgd ;}else {_bdb ,_ecf =_dgd ,_fbg ;};};};_cec =_ecf [2]-_ecf [0];_fceg =_ecf [3]-_ecf [1];var _dbcb float64 ;if _fcg .AutoSize {if _gffb > _cec ||_efd > _fceg {_ecbea :=_cd .Min (_cec /_gffb ,_fceg /_efd );_gab *=_ecbea ;};_eeeb =_fcg .LineHeight *_gab ;_dbcb +=(_fceg -float64 (len (_dbca ))*_eeeb )/2;};_gbdc :=_c .NewContentCreator ();_aab :=_cc .NewPdfPageResources ();_aab .SetFontByName (*_gedb ,_eefa .ToPdfObject ());if _fcg .BorderSize <=0{_fcg .BorderSize =0;_fcg .BorderColor =_cc .NewPdfColorDeviceGray (1);};if _fcg .BorderColor ==nil {_fcg .BorderColor =_cc .NewPdfColorDeviceGray (1);};if _fcg .FillColor ==nil {_fcg .FillColor =_cc .NewPdfColorDeviceGray (1);};_gbdc .Add_q ().SetNonStrokingColor (_fcg .FillColor ).SetStrokingColor (_fcg .BorderColor ).Add_w (_fcg .BorderSize ).Add_re (_cgfb [0],_cgfb [1],_bfb ,_gbf ).Add_B ().Add_Q ();if _fcg .WatermarkImage !=nil {_afga :=[]float64 {_cgfb [0],_cgfb [1],_cgfb [2],_cgfb [3]};_fba ,_beed ,_aca :=_dga (_fcg .WatermarkImage ,"\u0049\u006d\u0061\u0067\u0065\u0057\u0061\u0074\u0065r\u006d\u0061\u0072\u006b",_fcg ,_afga ,_gbdc );if _aca !=nil {return nil ,_aca ;};_aab .SetXObjectImageByName (*_fba ,_beed );};_gbdc .Add_q ();_gbdc .Translate (_ecf [0],_ecf [3]-_eeeb -_dbcb );_gbdc .Add_BT ();_aaaa :=_eefa .Encoder ();for _ ,_bda :=range _dbca {var _fdffe []byte ;for _ ,_bcf :=range _bda {if _gca .IsSpace (_bcf ){if len (_fdffe )> 0{_gbdc .SetNonStrokingColor (_fcg .TextColor ).Add_Tf (*_gedb ,_gab ).Add_TL (_eeeb ).Add_TJ ([]_fg .PdfObject {_fg .MakeStringFromBytes (_fdffe )}...);_fdffe =nil ;};_gbdc .Add_Tf (*_gedb ,_gab ).Add_TL (_eeeb ).Add_TJ ([]_fg .PdfObject {_fg .MakeFloat (-_bfee )}...);}else {_fdffe =append (_fdffe ,_aaaa .Encode (string (_bcf ))...);};};if len (_fdffe )> 0{_gbdc .SetNonStrokingColor (_fcg .TextColor ).Add_Tf (*_gedb ,_gab ).Add_TL (_eeeb ).Add_TJ ([]_fg .PdfObject {_fg .MakeStringFromBytes (_fdffe )}...);};_gbdc .Add_Td (0,-_eeeb );};_gbdc .Add_ET ();_gbdc .Add_Q ();if _agcd {_fcce ,_cgcg ,_bggf :=_dga (_fcg .Image ,"\u0049\u006d\u0061\u0067\u0065\u0053\u0069\u0067\u006ea\u0074\u0075\u0072\u0065",_fcg ,_bdb ,_gbdc );if _bggf !=nil {return nil ,_bggf ;};_aab .SetXObjectImageByName (*_fcce ,_cgcg );};_dee :=_cc .NewXObjectForm ();_dee .Resources =_aab ;_dee .BBox =_fg .MakeArrayFromFloats (_cgfb );_dee .SetContentStream (_gbdc .Bytes (),_gbe ());_egg :=_fg .MakeDict ();_egg .Set ("\u004e",_dee .ToPdfObject ());return _egg ,nil ;};

// FieldAppearance implements interface model.FieldAppearanceGenerator and generates appearance streams
// for fields taking into account what value is in the field. A common use case is for generating the
// appearance stream prior to flattening fields.
//
// If `OnlyIfMissing` is true, the field appearance is generated only for fields that do not have an
// appearance stream specified.
// If `RegenerateTextFields` is true, all text fields are regenerated (even if OnlyIfMissing is true).
type FieldAppearance struct{OnlyIfMissing bool ;RegenerateTextFields bool ;_dg *AppearanceStyle ;};func _bgf (_bee *_cc .PdfAnnotationWidget ,_ced *_cc .PdfFieldText ,_edd *_cc .PdfPageResources ,_eaec AppearanceStyle )(*_fg .PdfObjectDictionary ,error ){_cgg :=_cc .NewPdfPageResources ();_dbf ,_bce :=_fg .GetArray (_bee .Rect );if !_bce {return nil ,_gd .New ("\u0069\u006e\u0076a\u006c\u0069\u0064\u0020\u0052\u0065\u0063\u0074");};_dge ,_dbe :=_cc .NewPdfRectangle (*_dbf );if _dbe !=nil {return nil ,_dbe ;};_ded ,_cgdd :=_dge .Width (),_dge .Height ();_baf ,_ede :=_ded ,_cgdd ;_bfa ,_dfe :=_fg .GetDict (_bee .MK );if _dfe {_bbga ,_ :=_fg .GetDict (_bee .BS );_bgg :=_eaec .applyAppearanceCharacteristics (_bfa ,_bbga ,nil );if _bgg !=nil {return nil ,_bgg ;};};_agg ,_dfe :=_fg .GetIntVal (_ced .MaxLen );if !_dfe {return nil ,_gd .New ("\u006d\u0061\u0078\u006c\u0065\u006e\u0020\u006e\u006ft\u0020\u0073\u0065\u0074");};if _agg <=0{return nil ,_gd .New ("\u006d\u0061\u0078\u004c\u0065\u006e\u0020\u0069\u006ev\u0061\u006c\u0069\u0064");};_egc :=_ded /float64 (_agg );_cea ,_dbe :=_c .NewContentStreamParser (_facd (_ced .PdfField )).Parse ();if _dbe !=nil {return nil ,_dbe ;};_cce :=_c .NewContentCreator ();if _eaec .BorderSize > 0{_cadc (_cce ,_eaec ,_ded ,_cgdd );};if _eaec .DrawAlignmentReticle {_ccb :=_eaec ;_ccb .BorderSize =0.2;_aea (_cce ,_ccb ,_ded ,_cgdd );};_cce .Add_BMC ("\u0054\u0078");_cce .Add_q ();_ ,_cgdd =_eaec .applyRotation (_bfa ,_ded ,_cgdd ,_cce );_cce .Add_BT ();_fged ,_gg ,_dbe :=_eaec .processDA (_ced .PdfField ,_cea ,_edd ,_cgg ,_cce );if _dbe !=nil {return nil ,_dbe ;};_cdb :=_fged .Font ;_aedf :=_fg .MakeName (_fged .Name );_ccf :=_fged .Size ;_cfb :=_ccf ==0;if _cfb &&_gg {_ccf =_cgdd *_eaec .AutoFontSizeFraction ;};_cccf :=_cdb .Encoder ();if _cccf ==nil {_gc .Log .Debug ("\u0057\u0041RN\u003a\u0020\u0066\u006f\u006e\u0074\u0020\u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0069\u0073\u0020\u006e\u0069l\u002e\u0020\u0041\u0073s\u0075\u006d\u0069\u006eg \u0069\u0064e\u006et\u0069\u0074\u0079\u0020\u0065\u006ec\u006f\u0064\u0065r\u002e\u0020O\u0075\u0074\u0070\u0075\u0074\u0020\u006d\u0061\u0079\u0020\u0062\u0065\u0020\u0069n\u0063\u006f\u0072\u0072\u0065\u0063\u0074\u002e");_cccf =_e .NewIdentityTextEncoder ("\u0049\u0064\u0065\u006e\u0074\u0069\u0074\u0079\u002d\u0048");};var _dfd string ;if _eaafg ,_eefg :=_fg .GetString (_ced .V );_eefg {_dfd =_eaafg .Decoded ();};_cce .Add_Tf (*_aedf ,_ccf );var _cede float64 ;for _ ,_dgef :=range _dfd {_deg ,_eaeb :=_cdb .GetRuneMetrics (_dgef );if !_eaeb {_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052\u003a \u0052\u0075\u006e\u0065\u0020\u006e\u006f\u0074\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0066\u006fn\u0074\u003a\u0020\u0025\u0076\u0020\u002d\u0020\u0073\u006b\u0069\u0070\u0070\u0069n\u0067 \u006f\u0076\u0065\u0072",_dgef );continue ;};_bdg :=_deg .Wy ;if int (_bdg )<=0{_bdg =_deg .Wx ;};if _bdg > _cede {_cede =_bdg ;};};if int (_cede )==0{_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052\u003a\u0020\u0055\u006e\u0061\u0062\u006c\u0065\u0020\u0074o\u0020\u0064\u0065\u0074\u0065\u0072\u006d\u0069\u006e\u0065\u0020\u006d\u0061x\u0020\u0067\u006c\u0079\u0070\u0068\u0020\u0073\u0069\u007a\u0065\u0020- \u0075\u0073\u0069\u006e\u0067\u0020\u0031\u0030\u0030\u0030");_cede =1000;};_ecbe ,_dbe :=_cdb .GetFontDescriptor ();if _dbe !=nil {_gc .Log .Debug ("\u0045\u0072ro\u0072\u003a\u0020U\u006e\u0061\u0062\u006ce t\u006f g\u0065\u0074\u0020\u0066\u006f\u006e\u0074 d\u0065\u0073\u0063\u0072\u0069\u0070\u0074o\u0072");};var _ecgb float64 ;if _ecbe !=nil {_ecgb ,_dbe =_ecbe .GetCapHeight ();if _dbe !=nil {_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052\u003a\u0020\u0055\u006e\u0061\u0062\u006c\u0065 \u0074\u006f\u0020\u0067\u0065\u0074 \u0066\u006f\u006e\u0074\u0020\u0043\u0061\u0070\u0048\u0065\u0069\u0067\u0068t\u003a\u0020\u0025\u0076",_dbe );};};if int (_ecgb )<=0{_gc .Log .Debug ("W\u0041\u0052\u004e\u003a\u0020\u0043\u0061\u0070\u0048e\u0069\u0067\u0068\u0074\u0020\u006e\u006ft \u0061\u0076\u0061\u0069l\u0061\u0062\u006c\u0065\u0020\u002d\u0020\u0073\u0065tt\u0069\u006eg\u0020\u0074\u006f\u0020\u0031\u0030\u0030\u0030");_ecgb =1000.0;};_gafb :=_ecgb /1000.0*_ccf ;_cdbf :=0.0;_bgfa :=1.0*_ccf *(_cede /1000.0);{_agd :=_bgfa ;if _cfb &&_cdbf +_agd > _cgdd {_ccf =0.95*(_cgdd -_cdbf );_gafb =_ecgb /1000.0*_ccf ;};if _cgdd > _gafb {_cdbf =(_cgdd -_gafb )/2.0;};};_cce .Add_Td (0,_cdbf );if _beg ,_bcd :=_fg .GetIntVal (_ced .Q );_bcd {switch _beg {case 2:if len (_dfd )< _agg {_ffd :=float64 (_agg -len (_dfd ))*_egc ;_cce .Add_Td (_ffd ,0);};};};for _dcgc ,_aec :=range _dfd {_bdgd :=2.0;_cad :=string (_aec );if _cccf !=nil {_dag ,_dcef :=_cdb .GetRuneMetrics (_aec );if !_dcef {_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052\u003a \u0052\u0075\u006e\u0065\u0020\u006e\u006f\u0074\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0066\u006fn\u0074\u003a\u0020\u0025\u0076\u0020\u002d\u0020\u0073\u006b\u0069\u0070\u0070\u0069n\u0067 \u006f\u0076\u0065\u0072",_aec );continue ;};_cad =string (_cccf .Encode (_cad ));_decd :=_ccf *_dag .Wx /1000.0;_efg :=(_egc -_decd )/2;_bdgd =_efg ;};_cce .Add_Td (_bdgd ,0);_cce .Add_Tj (*_fg .MakeString (_cad ));if _dcgc !=len (_dfd )-1{_cce .Add_Td (_egc -_bdgd ,0);};};_cce .Add_ET ();_cce .Add_Q ();_cce .Add_EMC ();_ebcc :=_cc .NewXObjectForm ();_ebcc .Resources =_cgg ;_ebcc .BBox =_fg .MakeArrayFromFloats ([]float64 {0,0,_baf ,_ede });_ebcc .SetContentStream (_cce .Bytes (),_gbe ());_dagd :=_fg .MakeDict ();_dagd .Set ("\u004e",_ebcc .ToPdfObject ());return _dagd ,nil ;};

// CircleAnnotationDef defines a circle annotation or ellipse at position (X, Y) and Width and Height.
// The annotation has various style parameters including Fill and Border options and Opacity.
type CircleAnnotationDef struct{X float64 ;Y float64 ;Width float64 ;Height float64 ;FillEnabled bool ;FillColor *_cc .PdfColorDeviceRGB ;BorderEnabled bool ;BorderWidth float64 ;BorderColor *_cc .PdfColorDeviceRGB ;Opacity float64 ;};func _gbe ()_fg .StreamEncoder {return _fg .NewFlateEncoder ()};func _fdab (_daf LineAnnotationDef ,_abdbc string )([]byte ,*_cc .PdfRectangle ,*_cc .PdfRectangle ,error ){_eaba :=_ee .Line {X1 :0,Y1 :0,X2 :_daf .X2 -_daf .X1 ,Y2 :_daf .Y2 -_daf .Y1 ,LineColor :_daf .LineColor ,Opacity :_daf .Opacity ,LineWidth :_daf .LineWidth ,LineEndingStyle1 :_daf .LineEndingStyle1 ,LineEndingStyle2 :_daf .LineEndingStyle2 };_face ,_eeg ,_ddgd :=_eaba .Draw (_abdbc );if _ddgd !=nil {return nil ,nil ,nil ,_ddgd ;};_aced :=&_cc .PdfRectangle {};_aced .Llx =_daf .X1 +_eeg .Llx ;_aced .Lly =_daf .Y1 +_eeg .Lly ;_aced .Urx =_daf .X1 +_eeg .Urx ;_aced .Ury =_daf .Y1 +_eeg .Ury ;return _face ,_eeg ,_aced ,nil ;};func _ddc (_cca *_cc .PdfAnnotationWidget ,_afe *_cc .PdfFieldButton ,_eece *_cc .PdfPageResources ,_ffee AppearanceStyle )(*_fg .PdfObjectDictionary ,error ){_dfdd ,_ccaa :=_fg .GetArray (_cca .Rect );if !_ccaa {return nil ,_gd .New ("\u0069\u006e\u0076a\u006c\u0069\u0064\u0020\u0052\u0065\u0063\u0074");};_bfgc ,_cgf :=_cc .NewPdfRectangle (*_dfdd );if _cgf !=nil {return nil ,_cgf ;};_gaa ,_eaaff :=_bfgc .Width (),_bfgc .Height ();_gfb ,_fce :=_gaa ,_eaaff ;_gc .Log .Debug ("\u0043\u0068\u0065\u0063kb\u006f\u0078\u002c\u0020\u0077\u0061\u0020\u0042\u0053\u003a\u0020\u0025\u0076",_cca .BS );_cbb ,_cgf :=_cc .NewStandard14Font ("\u005a\u0061\u0070f\u0044\u0069\u006e\u0067\u0062\u0061\u0074\u0073");if _cgf !=nil {return nil ,_cgf ;};_cdbd ,_cdbc :=_fg .GetDict (_cca .MK );if _cdbc {_cbc ,_ :=_fg .GetDict (_cca .BS );_dda :=_ffee .applyAppearanceCharacteristics (_cdbd ,_cbc ,_cbb );if _dda !=nil {return nil ,_dda ;};};_aacf :=_cc .NewXObjectForm ();{_bbc :=_c .NewContentCreator ();if _ffee .BorderSize > 0{_cadc (_bbc ,_ffee ,_gaa ,_eaaff );};if _ffee .DrawAlignmentReticle {_ecef :=_ffee ;_ecef .BorderSize =0.2;_aea (_bbc ,_ecef ,_gaa ,_eaaff );};_gaa ,_eaaff =_ffee .applyRotation (_cdbd ,_gaa ,_eaaff ,_bbc );_bfd :=_ffee .AutoFontSizeFraction *_eaaff ;_fbe ,_bcdg :=_cbb .GetRuneMetrics (_ffee .CheckmarkRune );if !_bcdg {return nil ,_gd .New ("\u0067l\u0079p\u0068\u0020\u006e\u006f\u0074\u0020\u0066\u006f\u0075\u006e\u0064");};_bca :=_cbb .Encoder ();_bdf :=_bca .Encode (string (_ffee .CheckmarkRune ));_bfgf :=_fbe .Wx *_bfd /1000.0;_ecd :=705.0;_abe :=_ecd /1000.0*_bfd ;_bea :=2.0;_bac :=1.0;if _bfgf < _gaa {_bea =(_gaa -_bfgf )/2.0;};if _abe < _eaaff {_bac =(_eaaff -_abe )/2.0;};_bbc .Add_q ().Add_g (0).Add_BT ().Add_Tf ("\u005a\u0061\u0044\u0062",_bfd ).Add_Td (_bea ,_bac ).Add_Tj (*_fg .MakeStringFromBytes (_bdf )).Add_ET ().Add_Q ();_aacf .Resources =_cc .NewPdfPageResources ();_aacf .Resources .SetFontByName ("\u005a\u0061\u0044\u0062",_cbb .ToPdfObject ());_aacf .BBox =_fg .MakeArrayFromFloats ([]float64 {0,0,_gfb ,_fce });_aacf .SetContentStream (_bbc .Bytes (),_gbe ());};_geg :=_cc .NewXObjectForm ();{_adf :=_c .NewContentCreator ();if _ffee .BorderSize > 0{_cadc (_adf ,_ffee ,_gaa ,_eaaff );};_geg .BBox =_fg .MakeArrayFromFloats ([]float64 {0,0,_gfb ,_fce });_geg .SetContentStream (_adf .Bytes (),_gbe ());};_cadb :=_fg .MakeDict ();_cadb .Set ("\u004f\u0066\u0066",_geg .ToPdfObject ());_cadb .Set ("\u0059\u0065\u0073",_aacf .ToPdfObject ());_gfbf :=_fg .MakeDict ();_gfbf .Set ("\u004e",_cadb );return _gfbf ,nil ;};

// CreateLineAnnotation creates a line annotation object that can be added to page PDF annotations.
func CreateLineAnnotation (lineDef LineAnnotationDef )(*_cc .PdfAnnotation ,error ){_bfeef :=_cc .NewPdfAnnotationLine ();_bfeef .L =_fg .MakeArrayFromFloats ([]float64 {lineDef .X1 ,lineDef .Y1 ,lineDef .X2 ,lineDef .Y2 });_dcb :=_fg .MakeName ("\u004e\u006f\u006e\u0065");if lineDef .LineEndingStyle1 ==_ee .LineEndingStyleArrow {_dcb =_fg .MakeName ("C\u006c\u006f\u0073\u0065\u0064\u0041\u0072\u0072\u006f\u0077");};_bbde :=_fg .MakeName ("\u004e\u006f\u006e\u0065");if lineDef .LineEndingStyle2 ==_ee .LineEndingStyleArrow {_bbde =_fg .MakeName ("C\u006c\u006f\u0073\u0065\u0064\u0041\u0072\u0072\u006f\u0077");};_bfeef .LE =_fg .MakeArray (_dcb ,_bbde );if lineDef .Opacity < 1.0{_bfeef .CA =_fg .MakeFloat (lineDef .Opacity );};_egce ,_cfdg ,_gcaea :=lineDef .LineColor .R (),lineDef .LineColor .G (),lineDef .LineColor .B ();_bfeef .IC =_fg .MakeArrayFromFloats ([]float64 {_egce ,_cfdg ,_gcaea });_bfeef .C =_fg .MakeArrayFromFloats ([]float64 {_egce ,_cfdg ,_gcaea });_ggc :=_cc .NewBorderStyle ();_ggc .SetBorderWidth (lineDef .LineWidth );_bfeef .BS =_ggc .ToPdfObject ();_cedf ,_bec ,_dfa :=_ebdg (lineDef );if _dfa !=nil {return nil ,_dfa ;};_bfeef .AP =_cedf ;_bfeef .Rect =_fg .MakeArrayFromFloats ([]float64 {_bec .Llx ,_bec .Lly ,_bec .Urx ,_bec .Ury });return _bfeef .PdfAnnotation ,nil ;};func _aeb (_efga *_cc .PdfField ,_ddbe ,_ggf float64 ,_afb string ,_cge AppearanceStyle ,_ebd *_c .ContentStreamOperations ,_def *_cc .PdfPageResources ,_eeca *_fg .PdfObjectDictionary )(*_cc .XObjectForm ,error ){_gfae :=_cc .NewPdfPageResources ();_fbf ,_eee :=_ddbe ,_ggf ;_dab :=_c .NewContentCreator ();if _cge .BorderSize > 0{_cadc (_dab ,_cge ,_ddbe ,_ggf );};if _cge .DrawAlignmentReticle {_ebg :=_cge ;_ebg .BorderSize =0.2;_aea (_dab ,_ebg ,_ddbe ,_ggf );};_dab .Add_BMC ("\u0054\u0078");_dab .Add_q ();_dab .Add_BT ();_ddbe ,_ggf =_cge .applyRotation (_eeca ,_ddbe ,_ggf ,_dab );_cfg ,_abc ,_gac :=_cge .processDA (_efga ,_ebd ,_def ,_gfae ,_dab );if _gac !=nil {return nil ,_gac ;};_bacd :=_cfg .Font ;_dcf :=_cfg .Size ;_bacb :=_fg .MakeName (_cfg .Name );_cab :=_dcf ==0;if _cab &&_abc {_dcf =_ggf *_cge .AutoFontSizeFraction ;};_bbd :=_bacd .Encoder ();if _bbd ==nil {_gc .Log .Debug ("\u0057\u0041RN\u003a\u0020\u0066\u006f\u006e\u0074\u0020\u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0069\u0073\u0020\u006e\u0069l\u002e\u0020\u0041\u0073s\u0075\u006d\u0069\u006eg \u0069\u0064e\u006et\u0069\u0074\u0079\u0020\u0065\u006ec\u006f\u0064\u0065r\u002e\u0020O\u0075\u0074\u0070\u0075\u0074\u0020\u006d\u0061\u0079\u0020\u0062\u0065\u0020\u0069n\u0063\u006f\u0072\u0072\u0065\u0063\u0074\u002e");_bbd =_e .NewIdentityTextEncoder ("\u0049\u0064\u0065\u006e\u0074\u0069\u0074\u0079\u002d\u0048");};if len (_afb )==0{return nil ,nil ;};_feg :=2.0;_ceg :=0.0;if _bbd !=nil {for _ ,_dabe :=range _afb {_cfd ,_abdb :=_bacd .GetRuneMetrics (_dabe );if !_abdb {_gc .Log .Debug ("\u0046\u006f\u006e\u0074\u0020\u0064o\u0065\u0073\u0020\u006e\u006f\u0074\u0020\u0068\u0061\u0076\u0065\u0020\u0072\u0075\u006e\u0065\u0020\u006d\u0065\u0074r\u0069\u0063\u0073\u0020\u0066\u006f\u0072\u0020\u0025\u0076\u0020\u002d\u0020\u0073k\u0069p\u0070\u0069\u006e\u0067",_dabe );continue ;};_ceg +=_cfd .Wx ;};_afb =string (_bbd .Encode (_afb ));};if _dcf ==0||_cab &&_ceg > 0&&_feg +_ceg *_dcf /1000.0> _ddbe {_dcf =0.95*1000.0*(_ddbe -_feg )/_ceg ;};_ebe :=1.0*_dcf ;_efb :=2.0;{_ccgb :=_ebe ;if _cab &&_efb +_ccgb > _ggf {_dcf =0.95*(_ggf -_efb );_ebe =1.0*_dcf ;_ccgb =_ebe ;};if _ggf > _ccgb {_efb =(_ggf -_ccgb )/2.0;_efb +=1.50;};};_dab .Add_Tf (*_bacb ,_dcf );_dab .Add_Td (_feg ,_efb );_dab .Add_Tj (*_fg .MakeString (_afb ));_dab .Add_ET ();_dab .Add_Q ();_dab .Add_EMC ();_fdff :=_cc .NewXObjectForm ();_fdff .Resources =_gfae ;_fdff .BBox =_fg .MakeArrayFromFloats ([]float64 {0,0,_fbf ,_eee });_fdff .SetContentStream (_dab .Bytes (),_gbe ());return _fdff ,nil ;};

// NewSignatureFieldOpts returns a new initialized instance of options
// used to generate a signature appearance.
func NewSignatureFieldOpts ()*SignatureFieldOpts {return &SignatureFieldOpts {Font :_cc .DefaultFont (),FontSize :10,LineHeight :1,AutoSize :true ,TextColor :_cc .NewPdfColorDeviceGray (0),BorderColor :_cc .NewPdfColorDeviceGray (0),FillColor :_cc .NewPdfColorDeviceGray (1),Encoder :_fg .NewFlateEncoder (),ImagePosition :SignatureImageLeft };};

// NewSignatureField returns a new signature field with a visible appearance
// containing the specified signature lines and styled according to the
// specified options.
func NewSignatureField (signature *_cc .PdfSignature ,lines []*SignatureLine ,opts *SignatureFieldOpts )(*_cc .PdfFieldSignature ,error ){if signature ==nil {return nil ,_gd .New ("\u0073\u0069\u0067na\u0074\u0075\u0072\u0065\u0020\u0063\u0061\u006e\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u006e\u0069\u006c");};_dbad ,_caec :=_ecbd (lines ,opts );if _caec !=nil {return nil ,_caec ;};_aedd :=_cc .NewPdfFieldSignature (signature );_aedd .Rect =_fg .MakeArrayFromFloats (opts .Rect );_aedd .AP =_dbad ;return _aedd ,nil ;};func (_ecea *AppearanceStyle )processDA (_cbce *_cc .PdfField ,_agdcc *_c .ContentStreamOperations ,_ccbb ,_acgd *_cc .PdfPageResources ,_efbg *_c .ContentCreator )(*AppearanceFont ,bool ,error ){var _eac *AppearanceFont ;var _aggc bool ;if _ecea .Fonts !=nil {if _ecea .Fonts .Fallback !=nil {_eac =_ecea .Fonts .Fallback ;};if _ceaa :=_ecea .Fonts .FieldFallbacks ;_ceaa !=nil {if _edg ,_ebb :=_ceaa [_cbce .PartialName ()];_ebb {_eac =_edg ;}else if _dgb ,_ddaf :=_cbce .FullName ();_ddaf ==nil {if _ddg ,_acgg :=_ceaa [_dgb ];_acgg {_eac =_ddg ;};};};_aggc =_ecea .Fonts .ForceReplace ;};var _cff string ;var _dbc float64 ;var _geed bool ;if _agdcc !=nil {for _ ,_ccea :=range *_agdcc {if _ccea .Operand =="\u0054\u0066"&&len (_ccea .Params )==2{if _ged ,_eff :=_fg .GetNameVal (_ccea .Params [0]);_eff {_cff =_ged ;};if _bcef ,_gdeb :=_fg .GetNumberAsFloat (_ccea .Params [1]);_gdeb ==nil {_dbc =_bcef ;};_geed =true ;continue ;};_efbg .AddOperand (*_ccea );};};var _eea *AppearanceFont ;var _gaca _fg .PdfObject ;if _aggc &&_eac !=nil {_eea =_eac ;}else {if _ccbb !=nil &&_cff !=""{if _gge ,_gcee :=_ccbb .GetFontByName (*_fg .MakeName (_cff ));_gcee {if _fff ,_ceea :=_cc .NewPdfFontFromPdfObject (_gge );_ceea ==nil {_gaca =_gge ;_eea =&AppearanceFont {Name :_cff ,Font :_fff ,Size :_dbc };}else {_gc .Log .Debug ("\u0045\u0052\u0052\u004f\u0052:\u0020\u0063\u006f\u0075\u006c\u0064\u0020\u006e\u006f\u0074\u0020\u006c\u006fa\u0064\u0020\u0061\u0070\u0070\u0065\u0061\u0072\u0061\u006e\u0063\u0065\u0020\u0066\u006f\u006e\u0074\u003a\u0020\u0025\u0076",_ceea );};};};if _eea ==nil &&_eac !=nil {_eea =_eac ;};if _eea ==nil {_ffa ,_abee :=_cc .NewStandard14Font ("\u0048e\u006c\u0076\u0065\u0074\u0069\u0063a");if _abee !=nil {return nil ,false ,_abee ;};_eea =&AppearanceFont {Name :"\u0048\u0065\u006c\u0076",Font :_ffa ,Size :_dbc };};};_bcb :=*_fg .MakeName (_eea .Name );if _gaca ==nil {_gaca =_eea .Font .ToPdfObject ();};if _ccbb !=nil &&!_ccbb .HasFontByName (_bcb ){_ccbb .SetFontByName (_bcb ,_gaca );};if _acgd !=nil &&!_acgd .HasFontByName (_bcb ){_acgd .SetFontByName (_bcb ,_gaca );};return _eea ,_geed ,nil ;};func _ebdg (_afgd LineAnnotationDef )(*_fg .PdfObjectDictionary ,*_cc .PdfRectangle ,error ){_bcfd :=_cc .NewXObjectForm ();_bcfd .Resources =_cc .NewPdfPageResources ();_ade :="";if _afgd .Opacity < 1.0{_bced :=_fg .MakeDict ();_bced .Set ("\u0063\u0061",_fg .MakeFloat (_afgd .Opacity ));_baaa :=_bcfd .Resources .AddExtGState ("\u0067\u0073\u0031",_bced );if _baaa !=nil {_gc .Log .Debug ("U\u006e\u0061\u0062\u006c\u0065\u0020t\u006f\u0020\u0061\u0064\u0064\u0020\u0065\u0078\u0074g\u0073\u0074\u0061t\u0065 \u0067\u0073\u0031");return nil ,nil ,_baaa ;};_ade ="\u0067\u0073\u0031";};_edgf ,_fbed ,_efe ,_cdf :=_fdab (_afgd ,_ade );if _cdf !=nil {return nil ,nil ,_cdf ;};_cdf =_bcfd .SetContentStream (_edgf ,nil );if _cdf !=nil {return nil ,nil ,_cdf ;};_bcfd .BBox =_fbed .ToPdfObject ();_gdc :=_fg .MakeDict ();_gdc .Set ("\u004e",_bcfd .ToPdfObject ());return _gdc ,_efe ,nil ;};

// GenerateAppearanceDict generates an appearance dictionary for widget annotation `wa` for the `field` in `form`.
// Implements interface model.FieldAppearanceGenerator.
func (_fac FieldAppearance )GenerateAppearanceDict (form *_cc .PdfAcroForm ,field *_cc .PdfField ,wa *_cc .PdfAnnotationWidget )(*_fg .PdfObjectDictionary ,error ){_gc .Log .Trace ("\u0047\u0065n\u0065\u0072\u0061\u0074e\u0041\u0070p\u0065\u0061\u0072\u0061\u006e\u0063\u0065\u0044i\u0063\u0074\u0020\u0066\u006f\u0072\u0020\u0025\u0076\u0020\u0020\u0056:\u0020\u0025\u002b\u0076",field .PartialName (),field .V );_ ,_gdd :=field .GetContext ().(*_cc .PdfFieldText );_gf ,_ace :=_fg .GetDict (wa .AP );if _ace &&_fac .OnlyIfMissing &&(!_gdd ||!_fac .RegenerateTextFields ){_gc .Log .Trace ("\u0041\u006c\u0072\u0065a\u0064\u0079\u0020\u0070\u006f\u0070\u0075\u006c\u0061\u0074e\u0064 \u002d\u0020\u0069\u0067\u006e\u006f\u0072i\u006e\u0067");return _gf ,nil ;};if form .DR ==nil {form .DR =_cc .NewPdfPageResources ();};switch _bb :=field .GetContext ().(type ){case *_cc .PdfFieldText :_da :=_bb ;switch {case _da .Flags ().Has (_cc .FieldFlagPassword ):return nil ,nil ;case _da .Flags ().Has (_cc .FieldFlagFileSelect ):return nil ,nil ;case _da .Flags ().Has (_cc .FieldFlagComb ):if _da .MaxLen !=nil {_gcg ,_acg :=_bgf (wa ,_da ,form .DR ,_fac .Style ());if _acg !=nil {return nil ,_acg ;};return _gcg ,nil ;};};_be ,_aa :=_dd (wa ,_da ,form .DR ,_fac .Style ());if _aa !=nil {return nil ,_aa ;};return _be ,nil ;case *_cc .PdfFieldButton :_faf :=_bb ;if _faf .IsCheckbox (){_ecgg ,_ffe :=_ddc (wa ,_faf ,form .DR ,_fac .Style ());if _ffe !=nil {return nil ,_ffe ;};return _ecgg ,nil ;};_gc .Log .Debug ("\u0054\u004f\u0044\u004f\u003a\u0020\u0055\u004e\u0048\u0041\u004e\u0044\u004c\u0045\u0044 \u0062u\u0074\u0074\u006f\u006e\u0020\u0074\u0079\u0070\u0065\u003a\u0020\u0025\u002b\u0076",_faf .GetType ());case *_cc .PdfFieldChoice :_fd :=_bb ;switch {case _fd .Flags ().Has (_cc .FieldFlagCombo ):_aba ,_aeg :=_fdb (form ,wa ,_fd ,_fac .Style ());if _aeg !=nil {return nil ,_aeg ;};return _aba ,nil ;default:_gc .Log .Debug ("\u0054\u004f\u0044\u004f\u003a\u0020\u0055N\u0048\u0041\u004eD\u004c\u0045\u0044\u0020c\u0068\u006f\u0069\u0063\u0065\u0020\u0066\u0069\u0065\u006c\u0064\u0020\u0077\u0069\u0074\u0068\u0020\u0066\u006c\u0061\u0067\u0073\u003a\u0020\u0025\u0073",_fd .Flags ().String ());};default:_gc .Log .Debug ("\u0054\u004f\u0044\u004f\u003a\u0020\u0055\u004e\u0048\u0041N\u0044\u004c\u0045\u0044\u0020\u0066\u0069e\u006c\u0064\u0020\u0074\u0079\u0070\u0065\u003a\u0020\u0025\u0054",_bb );};return nil ,nil ;};