//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package testutils ;import (_f "crypto/md5";_ea "encoding/hex";_fe "errors";_ac "fmt";_dc "github.com/unidoc/unipdf/v3/common";_bgc "github.com/unidoc/unipdf/v3/core";_dg "image";_bba "image/png";_bb "io";_c "os";_bg "os/exec";_b "path/filepath";_e "strings";_d "testing";);func RunRenderTest (t *_d .T ,pdfPath ,outputDir ,baselineRenderPath string ,saveBaseline bool ){_bbf :=_e .TrimSuffix (_b .Base (pdfPath ),_b .Ext (pdfPath ));t .Run ("\u0072\u0065\u006e\u0064\u0065\u0072",func (_ebe *_d .T ){_ca :=_b .Join (outputDir ,_bbf );_ec :=_ca +"\u002d%\u0064\u002e\u0070\u006e\u0067";if _cbc :=RenderPDFToPNGs (pdfPath ,0,_ec );_cbc !=nil {_ebe .Skip (_cbc );};for _cdg :=1;true ;_cdg ++{_eae :=_ac .Sprintf ("\u0025s\u002d\u0025\u0064\u002e\u0070\u006eg",_ca ,_cdg );_bbfe :=_b .Join (baselineRenderPath ,_ac .Sprintf ("\u0025\u0073\u002d\u0025\u0064\u005f\u0065\u0078\u0070\u002e\u0070\u006e\u0067",_bbf ,_cdg ));if _ ,_da :=_c .Stat (_eae );_da !=nil {break ;};_ebe .Logf ("\u0025\u0073",_bbfe );if _ ,_fc :=_c .Stat (_bbfe );_c .IsNotExist (_fc ){if saveBaseline {_ebe .Logf ("\u0043\u006fp\u0079\u0069\u006eg\u0020\u0025\u0073\u0020\u002d\u003e\u0020\u0025\u0073",_eae ,_bbfe );CopyFile (_eae ,_bbfe );continue ;};break ;};_ebe .Run (_ac .Sprintf ("\u0070\u0061\u0067\u0065\u0025\u0064",_cdg ),func (_ga *_d .T ){_ga .Logf ("\u0043o\u006dp\u0061\u0072\u0069\u006e\u0067 \u0025\u0073 \u0076\u0073\u0020\u0025\u0073",_eae ,_bbfe );_dfd ,_cg :=ComparePNGFiles (_eae ,_bbfe );if _c .IsNotExist (_cg ){_ga .Fatal ("\u0069m\u0061g\u0065\u0020\u0066\u0069\u006ce\u0020\u006di\u0073\u0073\u0069\u006e\u0067");}else if !_dfd {_ga .Fatal ("\u0077\u0072\u006f\u006eg \u0070\u0061\u0067\u0065\u0020\u0072\u0065\u006e\u0064\u0065\u0072\u0065\u0064");};});};});};func RenderPDFToPNGs (pdfPath string ,dpi int ,outpathTpl string )error {if dpi <=0{dpi =100;};if _ ,_bf :=_bg .LookPath ("\u0067\u0073");_bf !=nil {return ErrRenderNotSupported ;};return _bg .Command ("\u0067\u0073","\u002d\u0073\u0044\u0045\u0056\u0049\u0043\u0045\u003d\u0070\u006e\u0067a\u006c\u0070\u0068\u0061","\u002d\u006f",outpathTpl ,_ac .Sprintf ("\u002d\u0072\u0025\u0064",dpi ),pdfPath ).Run ();};func ComparePNGFiles (file1 ,file2 string )(bool ,error ){_ffg ,_gbd :=HashFile (file1 );if _gbd !=nil {return false ,_gbd ;};_gcb ,_gbd :=HashFile (file2 );if _gbd !=nil {return false ,_gbd ;};if _ffg ==_gcb {return true ,nil ;};_eg ,_gbd :=ReadPNG (file1 );if _gbd !=nil {return false ,_gbd ;};_bce ,_gbd :=ReadPNG (file2 );if _gbd !=nil {return false ,_gbd ;};if _eg .Bounds ()!=_bce .Bounds (){return false ,nil ;};return CompareImages (_eg ,_bce );};func CopyFile (src ,dst string )error {_bc ,_fd :=_c .Open (src );if _fd !=nil {return _fd ;};defer _bc .Close ();_ae ,_fd :=_c .Create (dst );if _fd !=nil {return _fd ;};defer _ae .Close ();_ ,_fd =_bb .Copy (_ae ,_bc );return _fd ;};func ParseIndirectObjects (rawpdf string )(map[int64 ]_bgc .PdfObject ,error ){_aee :=_bgc .NewParserFromString (rawpdf );_bfa :=map[int64 ]_bgc .PdfObject {};for {_bcc ,_bfad :=_aee .ParseIndirectObject ();if _bfad !=nil {if _bfad ==_bb .EOF {break ;};return nil ,_bfad ;};switch _daa :=_bcc .(type ){case *_bgc .PdfIndirectObject :_bfa [_daa .ObjectNumber ]=_bcc ;case *_bgc .PdfObjectStream :_bfa [_daa .ObjectNumber ]=_bcc ;};};for _ ,_dce :=range _bfa {_cfb (_dce ,_bfa );};return _bfa ,nil ;};func CompareDictionariesDeep (d1 ,d2 *_bgc .PdfObjectDictionary )bool {if len (d1 .Keys ())!=len (d2 .Keys ()){_dc .Log .Debug ("\u0044\u0069\u0063\u0074\u0020\u0065\u006e\u0074\u0072\u0069\u0065\u0073\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",len (d1 .Keys ()),len (d2 .Keys ()));_dc .Log .Debug ("\u0057\u0061s\u0020\u0027\u0025s\u0027\u0020\u0076\u0073\u0020\u0027\u0025\u0073\u0027",d1 .WriteString (),d2 .WriteString ());return false ;};for _ ,_eag :=range d1 .Keys (){if _eag =="\u0050\u0061\u0072\u0065\u006e\u0074"{continue ;};_gae :=_bgc .TraceToDirectObject (d1 .Get (_eag ));_gce :=_bgc .TraceToDirectObject (d2 .Get (_eag ));if _gae ==nil {_dc .Log .Debug ("\u00761\u0020\u0069\u0073\u0020\u006e\u0069l");return false ;};if _gce ==nil {_dc .Log .Debug ("\u00762\u0020\u0069\u0073\u0020\u006e\u0069l");return false ;};switch _aed :=_gae .(type ){case *_bgc .PdfObjectDictionary :_gab ,_adg :=_gce .(*_bgc .PdfObjectDictionary );if !_adg {_dc .Log .Debug ("\u0054\u0079\u0070\u0065 m\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0020\u0025\u0054\u0020\u0076\u0073\u0020%\u0054",_gae ,_gce );return false ;};if !CompareDictionariesDeep (_aed ,_gab ){return false ;};continue ;case *_bgc .PdfObjectArray :_bgaf ,_gdd :=_gce .(*_bgc .PdfObjectArray );if !_gdd {_dc .Log .Debug ("\u00762\u0020n\u006f\u0074\u0020\u0061\u006e\u0020\u0061\u0072\u0072\u0061\u0079");return false ;};if _aed .Len ()!=_bgaf .Len (){_dc .Log .Debug ("\u0061\u0072\u0072\u0061\u0079\u0020\u006c\u0065\u006e\u0067\u0074\u0068\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",_aed .Len (),_bgaf .Len ());return false ;};for _ef :=0;_ef < _aed .Len ();_ef ++{_dbf :=_bgc .TraceToDirectObject (_aed .Get (_ef ));_gceb :=_bgc .TraceToDirectObject (_bgaf .Get (_ef ));if _ba ,_cfg :=_dbf .(*_bgc .PdfObjectDictionary );_cfg {_bcf ,_eff :=_gceb .(*_bgc .PdfObjectDictionary );if !_eff {return false ;};if !CompareDictionariesDeep (_ba ,_bcf ){return false ;};}else {if _dbf .WriteString ()!=_gceb .WriteString (){_dc .Log .Debug ("M\u0069\u0073\u006d\u0061tc\u0068 \u0027\u0025\u0073\u0027\u0020!\u003d\u0020\u0027\u0025\u0073\u0027",_dbf .WriteString (),_gceb .WriteString ());return false ;};};};continue ;};if _gae .String ()!=_gce .String (){_dc .Log .Debug ("\u006b\u0065y\u003d\u0025\u0073\u0020\u004d\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0021\u0020\u0027\u0025\u0073\u0027\u0020\u0021\u003d\u0020'%\u0073\u0027",_eag ,_gae .String (),_gce .String ());_dc .Log .Debug ("\u0046o\u0072 \u0027\u0025\u0054\u0027\u0020\u002d\u0020\u0027\u0025\u0054\u0027",_gae ,_gce );_dc .Log .Debug ("\u0046\u006f\u0072\u0020\u0027\u0025\u002b\u0076\u0027\u0020\u002d\u0020'\u0025\u002b\u0076\u0027",_gae ,_gce );return false ;};};return true ;};func HashFile (file string )(string ,error ){_eb ,_db :=_c .Open (file );if _db !=nil {return "",_db ;};defer _eb .Close ();_fdg :=_f .New ();if _ ,_db =_bb .Copy (_fdg ,_eb );_db !=nil {return "",_db ;};return _ea .EncodeToString (_fdg .Sum (nil )),nil ;};func ReadPNG (file string )(_dg .Image ,error ){_g ,_df :=_c .Open (file );if _df !=nil {return nil ,_df ;};defer _g .Close ();return _bba .Decode (_g );};func CompareImages (img1 ,img2 _dg .Image )(bool ,error ){_dbb :=img1 .Bounds ();_gc :=0;for _gb :=0;_gb < _dbb .Size ().X ;_gb ++{for _ff :=0;_ff < _dbb .Size ().Y ;_ff ++{_ee ,_af ,_aa ,_ :=img1 .At (_gb ,_ff ).RGBA ();_cb ,_aca ,_cd ,_ :=img2 .At (_gb ,_ff ).RGBA ();if _ee !=_cb ||_af !=_aca ||_aa !=_cd {_gc ++;};};};_gd :=float64 (_gc )/float64 (_dbb .Dx ()*_dbb .Dy ());if _gd > 0.0001{_ac .Printf ("\u0064\u0069\u0066f \u0066\u0072\u0061\u0063\u0074\u0069\u006f\u006e\u003a\u0020\u0025\u0076\u0020\u0028\u0025\u0064\u0029\u000a",_gd ,_gc );return false ,nil ;};return true ,nil ;};var (ErrRenderNotSupported =_fe .New ("\u0072\u0065\u006e\u0064\u0065r\u0069\u006e\u0067\u0020\u0050\u0044\u0046\u0020\u0066\u0069\u006c\u0065\u0073 \u0069\u0073\u0020\u006e\u006f\u0074\u0020\u0073\u0075\u0070\u0070\u006f\u0072\u0074\u0065\u0064\u0020\u006f\u006e\u0020\u0074\u0068\u0069\u0073\u0020\u0073\u0079\u0073\u0074\u0065m"););func _cfb (_ag _bgc .PdfObject ,_ge map[int64 ]_bgc .PdfObject )error {switch _aga :=_ag .(type ){case *_bgc .PdfIndirectObject :_cec :=_aga ;_cfb (_cec .PdfObject ,_ge );case *_bgc .PdfObjectDictionary :_gbda :=_aga ;for _ ,_ed :=range _gbda .Keys (){_de :=_gbda .Get (_ed );if _ffc ,_fda :=_de .(*_bgc .PdfObjectReference );_fda {_ad ,_bgce :=_ge [_ffc .ObjectNumber ];if !_bgce {return _fe .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");};_gbda .Set (_ed ,_ad );}else {_cfb (_de ,_ge );};};case *_bgc .PdfObjectArray :_dbc :=_aga ;for _cdgf ,_ab :=range _dbc .Elements (){if _aeg ,_bff :=_ab .(*_bgc .PdfObjectReference );_bff {_gcd ,_bgd :=_ge [_aeg .ObjectNumber ];if !_bgd {return _fe .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");};_dbc .Set (_cdgf ,_gcd );}else {_cfb (_ab ,_ge );};};};return nil ;};