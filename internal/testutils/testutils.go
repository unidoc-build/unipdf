//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package testutils ;import (_e "crypto/md5";_g "encoding/hex";_df "errors";_ec "fmt";_gc "github.com/unidoc/unipdf/v3/common";_dfg "github.com/unidoc/unipdf/v3/core";_f "image";_cb "image/png";_de "io";_dg "os";_bb "os/exec";_ea "path/filepath";_c "strings";
_d "testing";);var (ErrRenderNotSupported =_df .New ("\u0072\u0065\u006e\u0064\u0065r\u0069\u006e\u0067\u0020\u0050\u0044\u0046\u0020\u0066\u0069\u006c\u0065\u0073 \u0069\u0073\u0020\u006e\u006f\u0074\u0020\u0073\u0075\u0070\u0070\u006f\u0072\u0074\u0065\u0064\u0020\u006f\u006e\u0020\u0074\u0068\u0069\u0073\u0020\u0073\u0079\u0073\u0074\u0065m");
);func HashFile (file string )(string ,error ){_eab ,_aa :=_dg .Open (file );if _aa !=nil {return "",_aa ;};defer _eab .Close ();_da :=_e .New ();if _ ,_aa =_de .Copy (_da ,_eab );_aa !=nil {return "",_aa ;};return _g .EncodeToString (_da .Sum (nil )),nil ;
};func ComparePNGFiles (file1 ,file2 string )(bool ,error ){_gg ,_dfc :=HashFile (file1 );if _dfc !=nil {return false ,_dfc ;};_bfc ,_dfc :=HashFile (file2 );if _dfc !=nil {return false ,_dfc ;};if _gg ==_bfc {return true ,nil ;};_dag ,_dfc :=ReadPNG (file1 );
if _dfc !=nil {return false ,_dfc ;};_bg ,_dfc :=ReadPNG (file2 );if _dfc !=nil {return false ,_dfc ;};if _dag .Bounds ()!=_bg .Bounds (){return false ,nil ;};return CompareImages (_dag ,_bg );};func CopyFile (src ,dst string )error {_fd ,_fa :=_dg .Open (src );
if _fa !=nil {return _fa ;};defer _fd .Close ();_fae ,_fa :=_dg .Create (dst );if _fa !=nil {return _fa ;};defer _fae .Close ();_ ,_fa =_de .Copy (_fae ,_fd );return _fa ;};func RunRenderTest (t *_d .T ,pdfPath ,outputDir ,baselineRenderPath string ,saveBaseline bool ){_ga :=_c .TrimSuffix (_ea .Base (pdfPath ),_ea .Ext (pdfPath ));
t .Run ("\u0072\u0065\u006e\u0064\u0065\u0072",func (_ef *_d .T ){_gae :=_ea .Join (outputDir ,_ga );_fe :=_gae +"\u002d%\u0064\u002e\u0070\u006e\u0067";if _fab :=RenderPDFToPNGs (pdfPath ,0,_fe );_fab !=nil {_ef .Skip (_fab );};for _fg :=1;true ;_fg ++{_gag :=_ec .Sprintf ("\u0025s\u002d\u0025\u0064\u002e\u0070\u006eg",_gae ,_fg );
_fca :=_ea .Join (baselineRenderPath ,_ec .Sprintf ("\u0025\u0073\u002d\u0025\u0064\u005f\u0065\u0078\u0070\u002e\u0070\u006e\u0067",_ga ,_fg ));if _ ,_fdc :=_dg .Stat (_gag );_fdc !=nil {break ;};_ef .Logf ("\u0025\u0073",_fca );if saveBaseline {_ef .Logf ("\u0043\u006fp\u0079\u0069\u006eg\u0020\u0025\u0073\u0020\u002d\u003e\u0020\u0025\u0073",_gag ,_fca );
_ae :=CopyFile (_gag ,_fca );if _ae !=nil {_ef .Fatalf ("\u0045\u0052\u0052OR\u0020\u0063\u006f\u0070\u0079\u0069\u006e\u0067\u0020\u0074\u006f\u0020\u0025\u0073\u003a\u0020\u0025\u0076",_fca ,_ae );};continue ;};_ef .Run (_ec .Sprintf ("\u0070\u0061\u0067\u0065\u0025\u0064",_fg ),func (_cg *_d .T ){_cg .Logf ("\u0043o\u006dp\u0061\u0072\u0069\u006e\u0067 \u0025\u0073 \u0076\u0073\u0020\u0025\u0073",_gag ,_fca );
_adg ,_fee :=ComparePNGFiles (_gag ,_fca );if _dg .IsNotExist (_fee ){_cg .Fatal ("\u0069m\u0061g\u0065\u0020\u0066\u0069\u006ce\u0020\u006di\u0073\u0073\u0069\u006e\u0067");}else if !_adg {_cg .Fatal ("\u0077\u0072\u006f\u006eg \u0070\u0061\u0067\u0065\u0020\u0072\u0065\u006e\u0064\u0065\u0072\u0065\u0064");
};});};});};func _cc (_cf _dfg .PdfObject ,_af map[int64 ]_dfg .PdfObject )error {switch _dad :=_cf .(type ){case *_dfg .PdfIndirectObject :_adb :=_dad ;_cc (_adb .PdfObject ,_af );case *_dfg .PdfObjectDictionary :_cec :=_dad ;for _ ,_cce :=range _cec .Keys (){_db :=_cec .Get (_cce );
if _dagc ,_dbe :=_db .(*_dfg .PdfObjectReference );_dbe {_abd ,_cbbb :=_af [_dagc .ObjectNumber ];if !_cbbb {return _df .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");
};_cec .Set (_cce ,_abd );}else {_cc (_db ,_af );};};case *_dfg .PdfObjectArray :_dab :=_dad ;for _aef ,_bbc :=range _dab .Elements (){if _be ,_bbf :=_bbc .(*_dfg .PdfObjectReference );_bbf {_ag ,_beb :=_af [_be .ObjectNumber ];if !_beb {return _df .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");
};_dab .Set (_aef ,_ag );}else {_cc (_bbc ,_af );};};};return nil ;};func ParseIndirectObjects (rawpdf string )(map[int64 ]_dfg .PdfObject ,error ){_ce :=_dfg .NewParserFromString (rawpdf );_bgd :=map[int64 ]_dfg .PdfObject {};for {_gac ,_eed :=_ce .ParseIndirectObject ();
if _eed !=nil {if _eed ==_de .EOF {break ;};return nil ,_eed ;};switch _fbg :=_gac .(type ){case *_dfg .PdfIndirectObject :_bgd [_fbg .ObjectNumber ]=_gac ;case *_dfg .PdfObjectStream :_bgd [_fbg .ObjectNumber ]=_gac ;};};for _ ,_ac :=range _bgd {_cc (_ac ,_bgd );
};return _bgd ,nil ;};func ReadPNG (file string )(_f .Image ,error ){_cbb ,_bf :=_dg .Open (file );if _bf !=nil {return nil ,_bf ;};defer _cbb .Close ();return _cb .Decode (_cbb );};func RenderPDFToPNGs (pdfPath string ,dpi int ,outpathTpl string )error {if dpi <=0{dpi =100;
};if _ ,_ad :=_bb .LookPath ("\u0067\u0073");_ad !=nil {return ErrRenderNotSupported ;};return _bb .Command ("\u0067\u0073","\u002d\u0073\u0044\u0045\u0056\u0049\u0043\u0045\u003d\u0070\u006e\u0067a\u006c\u0070\u0068\u0061","\u002d\u006f",outpathTpl ,_ec .Sprintf ("\u002d\u0072\u0025\u0064",dpi ),pdfPath ).Run ();
};func CompareDictionariesDeep (d1 ,d2 *_dfg .PdfObjectDictionary )bool {if len (d1 .Keys ())!=len (d2 .Keys ()){_gc .Log .Debug ("\u0044\u0069\u0063\u0074\u0020\u0065\u006e\u0074\u0072\u0069\u0065\u0073\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",len (d1 .Keys ()),len (d2 .Keys ()));
_gc .Log .Debug ("\u0057\u0061s\u0020\u0027\u0025s\u0027\u0020\u0076\u0073\u0020\u0027\u0025\u0073\u0027",d1 .WriteString (),d2 .WriteString ());return false ;};for _ ,_cfa :=range d1 .Keys (){if _cfa =="\u0050\u0061\u0072\u0065\u006e\u0074"{continue ;
};_eg :=_dfg .TraceToDirectObject (d1 .Get (_cfa ));_fcf :=_dfg .TraceToDirectObject (d2 .Get (_cfa ));if _eg ==nil {_gc .Log .Debug ("\u00761\u0020\u0069\u0073\u0020\u006e\u0069l");return false ;};if _fcf ==nil {_gc .Log .Debug ("\u00762\u0020\u0069\u0073\u0020\u006e\u0069l");
return false ;};switch _ead :=_eg .(type ){case *_dfg .PdfObjectDictionary :_gf ,_ceg :=_fcf .(*_dfg .PdfObjectDictionary );if !_ceg {_gc .Log .Debug ("\u0054\u0079\u0070\u0065 m\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0020\u0025\u0054\u0020\u0076\u0073\u0020%\u0054",_eg ,_fcf );
return false ;};if !CompareDictionariesDeep (_ead ,_gf ){return false ;};continue ;case *_dfg .PdfObjectArray :_feeg ,_bfa :=_fcf .(*_dfg .PdfObjectArray );if !_bfa {_gc .Log .Debug ("\u00762\u0020n\u006f\u0074\u0020\u0061\u006e\u0020\u0061\u0072\u0072\u0061\u0079");
return false ;};if _ead .Len ()!=_feeg .Len (){_gc .Log .Debug ("\u0061\u0072\u0072\u0061\u0079\u0020\u006c\u0065\u006e\u0067\u0074\u0068\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",_ead .Len (),_feeg .Len ());
return false ;};for _fcd :=0;_fcd < _ead .Len ();_fcd ++{_cbf :=_dfg .TraceToDirectObject (_ead .Get (_fcd ));_cfda :=_dfg .TraceToDirectObject (_feeg .Get (_fcd ));if _cbfd ,_ade :=_cbf .(*_dfg .PdfObjectDictionary );_ade {_abde ,_fcaa :=_cfda .(*_dfg .PdfObjectDictionary );
if !_fcaa {return false ;};if !CompareDictionariesDeep (_cbfd ,_abde ){return false ;};}else {if _cbf .WriteString ()!=_cfda .WriteString (){_gc .Log .Debug ("M\u0069\u0073\u006d\u0061tc\u0068 \u0027\u0025\u0073\u0027\u0020!\u003d\u0020\u0027\u0025\u0073\u0027",_cbf .WriteString (),_cfda .WriteString ());
return false ;};};};continue ;};if _eg .String ()!=_fcf .String (){_gc .Log .Debug ("\u006b\u0065y\u003d\u0025\u0073\u0020\u004d\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0021\u0020\u0027\u0025\u0073\u0027\u0020\u0021\u003d\u0020'%\u0073\u0027",_cfa ,_eg .String (),_fcf .String ());
_gc .Log .Debug ("\u0046o\u0072 \u0027\u0025\u0054\u0027\u0020\u002d\u0020\u0027\u0025\u0054\u0027",_eg ,_fcf );_gc .Log .Debug ("\u0046\u006f\u0072\u0020\u0027\u0025\u002b\u0076\u0027\u0020\u002d\u0020'\u0025\u002b\u0076\u0027",_eg ,_fcf );return false ;
};};return true ;};func CompareImages (img1 ,img2 _f .Image )(bool ,error ){_eae :=img1 .Bounds ();_fc :=0;for _fb :=0;_fb < _eae .Size ().X ;_fb ++{for _faa :=0;_faa < _eae .Size ().Y ;_faa ++{_ba ,_dc ,_ge ,_ :=img1 .At (_fb ,_faa ).RGBA ();_ee ,_cbd ,_ed ,_ :=img2 .At (_fb ,_faa ).RGBA ();
if _ba !=_ee ||_dc !=_cbd ||_ge !=_ed {_fc ++;};};};_edb :=float64 (_fc )/float64 (_eae .Dx ()*_eae .Dy ());if _edb > 0.0001{_ec .Printf ("\u0064\u0069\u0066f \u0066\u0072\u0061\u0063\u0074\u0069\u006f\u006e\u003a\u0020\u0025\u0076\u0020\u0028\u0025\u0064\u0029\u000a",_edb ,_fc );
return false ,nil ;};return true ,nil ;};